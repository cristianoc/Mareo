!function(){"use strict";var r=["blocks.png","items.png","enemies.png","mario-small.png"],c=[2400,256],e="canvas",R=300,n=2400,t=256,j=5;function u(r,n,e){for(var t=new Array(e),i=0,o=n;i<e;)t[i]=r[o],i=i+1|0,o=o+1|0;return t}function f(r,n,e){if(n<0||n>=r.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};r[n]=e}function d(r,n){if(n<0||n>=r.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};return r[n]}function s(r,n){for(;;){var e=n,t=r,i=t.length,o=0===i?1:i,a=o-e.length|0;if(0==a)return t.apply(null,e);if(0<=a)return function(n,e){return function(r){return s(n,e.concat([r]))}}(t,e);n=u(e,o,0|-a),r=t.apply(null,u(e,0,o))}}function i(n){return 1===n.length?n:function(r){return function(a,u){var r=a.length;if(1===r)return a(u);switch(r){case 1:return a(u);case 2:return function(r){return a(u,r)};case 3:return function(r,n){return a(u,r,n)};case 4:return function(r,n,e){return a(u,r,n,e)};case 5:return function(r,n,e,t){return a(u,r,n,e,t)};case 6:return function(r,n,e,t,i){return a(u,r,n,e,t,i)};case 7:return function(r,n,e,t,i,o){return a(u,r,n,e,t,i,o)};default:return s(a,[u])}}(n,r)}}function o(e){return 2===e.length?e:function(r,n){return function(o,a,u){var r=o.length;if(2===r)return o(a,u);switch(r){case 1:return s(o(a),[u]);case 2:return o(a,u);case 3:return function(r){return o(a,u,r)};case 4:return function(r,n){return o(a,u,r,n)};case 5:return function(r,n,e){return o(a,u,r,n,e)};case 6:return function(r,n,e,t){return o(a,u,r,n,e,t)};case 7:return function(r,n,e,t,i){return o(a,u,r,n,e,t,i)};default:return s(o,[a,u])}}(e,r,n)}}function a(r,n){return r<n?r:n}function v(r,n){return n<r?r:n}var _=function(r,n){for(var e in r)n(e)};function l(n,e){if(n===e)return 1;var r=typeof n;if("string"!=r&&"number"!=r&&"boolean"!=r&&"undefined"!=r&&null!==n){var t=typeof e;if("function"==r||"function"==t)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: functional value",Error:new Error};if("number"!=t&&"undefined"!=t&&null!==e){var i=0|n.TAG,o=0|e.TAG;if(248==i)return n[1]===e[1];if(251==i)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: abstract value",Error:new Error};if(i==o){if(256==i)return n[1]===e[1];var a=0|n.length;if(a==(0|e.length)){if(!Array.isArray(n)){if(n instanceof Date&&e instanceof Date)return!(e<n||n<e);var u={contents:!0};return _(n,function(r){e.hasOwnProperty(r)||(u.contents=!1)}),u.contents&&_(e,function(r){n.hasOwnProperty(r)&&l(e[r],n[r])||(u.contents=!1)}),u.contents}for(var s=0;;){var c=s;if(c===a)return 1;if(!l(n[c],e[c]))return;s=c+1|0}}}}}}function p(r,n,e,t,i,o){var a=((n+r|0)+t|0)+o|0;return(a<<i|a>>>(32-i|0)|0)+e|0}function x(r,n,e,t,i,o,a){return p(n&e|(-1^n)&t,r,n,i,o,a)}function m(r,n,e,t,i,o,a){return p(n&t|e&(-1^t),r,n,i,o,a)}function y(r,n,e,t,i,o,a){return p(n^e^t,r,n,i,o,a)}function g(r,n,e,t,i,o,a){return p(e^(n|-1^t),r,n,i,o,a)}function h(r,n){var e=x(e=r[0],o=r[1],i=r[2],t=r[3],n[0],7,-680876936),t=x(t,e,o,i,n[1],12,-389564586),i=x(i,t,e,o,n[2],17,606105819),o=x(o,i,t,e,n[3],22,-1044525330);e=x(e,o,i,t,n[4],7,-176418897),t=x(t,e,o,i,n[5],12,1200080426),i=x(i,t,e,o,n[6],17,-1473231341),o=x(o,i,t,e,n[7],22,-45705983),e=x(e,o,i,t,n[8],7,1770035416),t=x(t,e,o,i,n[9],12,-1958414417),i=x(i,t,e,o,n[10],17,-42063),o=x(o,i,t,e,n[11],22,-1990404162),e=x(e,o,i,t,n[12],7,1804603682),t=x(t,e,o,i,n[13],12,-40341101),i=x(i,t,e,o,n[14],17,-1502002290),e=m(e,o=x(o,i,t,e,n[15],22,1236535329),i,t,n[1],5,-165796510),t=m(t,e,o,i,n[6],9,-1069501632),i=m(i,t,e,o,n[11],14,643717713),o=m(o,i,t,e,n[0],20,-373897302),e=m(e,o,i,t,n[5],5,-701558691),t=m(t,e,o,i,n[10],9,38016083),i=m(i,t,e,o,n[15],14,-660478335),o=m(o,i,t,e,n[4],20,-405537848),e=m(e,o,i,t,n[9],5,568446438),t=m(t,e,o,i,n[14],9,-1019803690),i=m(i,t,e,o,n[3],14,-187363961),o=m(o,i,t,e,n[8],20,1163531501),e=m(e,o,i,t,n[13],5,-1444681467),t=m(t,e,o,i,n[2],9,-51403784),i=m(i,t,e,o,n[7],14,1735328473),e=y(e,o=m(o,i,t,e,n[12],20,-1926607734),i,t,n[5],4,-378558),t=y(t,e,o,i,n[8],11,-2022574463),i=y(i,t,e,o,n[11],16,1839030562),o=y(o,i,t,e,n[14],23,-35309556),e=y(e,o,i,t,n[1],4,-1530992060),t=y(t,e,o,i,n[4],11,1272893353),i=y(i,t,e,o,n[7],16,-155497632),o=y(o,i,t,e,n[10],23,-1094730640),e=y(e,o,i,t,n[13],4,681279174),t=y(t,e,o,i,n[0],11,-358537222),i=y(i,t,e,o,n[3],16,-722521979),o=y(o,i,t,e,n[6],23,76029189),e=y(e,o,i,t,n[9],4,-640364487),t=y(t,e,o,i,n[12],11,-421815835),i=y(i,t,e,o,n[15],16,530742520),e=g(e,o=y(o,i,t,e,n[2],23,-995338651),i,t,n[0],6,-198630844),t=g(t,e,o,i,n[7],10,1126891415),i=g(i,t,e,o,n[14],15,-1416354905),o=g(o,i,t,e,n[5],21,-57434055),e=g(e,o,i,t,n[12],6,1700485571),t=g(t,e,o,i,n[3],10,-1894986606),i=g(i,t,e,o,n[10],15,-1051523),o=g(o,i,t,e,n[1],21,-2054922799),e=g(e,o,i,t,n[8],6,1873313359),t=g(t,e,o,i,n[15],10,-30611744),i=g(i,t,e,o,n[6],15,-1560198380),o=g(o,i,t,e,n[13],21,1309151649),e=g(e,o,i,t,n[4],6,-145523070),t=g(t,e,o,i,n[11],10,-1120210379),i=g(i,t,e,o,n[2],15,718787259),o=g(o,i,t,e,n[9],21,-343485551),r[0]=e+r[0]|0,r[1]=o+r[1]|0,r[2]=i+r[2]|0,r[3]=t+r[3]|0}var b=[1732584193,-271733879,-1732584194,271733878],w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function k(r,n){if(n>=r.length||n<0)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};return r.charCodeAt(n)}function A(r){throw{RE_EXN_ID:"Failure",_1:r,Error:new Error}}function T(r,n){return r?{_0:r._0,_1:T(r._1,n)}:n}function E(r){return function(r,n,e){var t=r.slice(n,e),i=t.length;b[0]=1732584193,b[1]=-271733879,b[2]=-1732584194,b[3]=271733878;for(var o=0;o<=15;++o)w[o]=0;for(var a=i/64|0,u=1;u<=a;++u){for(var s=0;s<=15;++s){var c=((u<<6)-64|0)+(s<<2)|0;w[s]=((t.charCodeAt(c)+(t.charCodeAt(1+c|0)<<8)|0)+(t.charCodeAt(2+c|0)<<16)|0)+(t.charCodeAt(3+c|0)<<24)|0}h(b,w)}for(var v=t.slice(a<<6),_=0;_<=15;++_)w[_]=0;for(var f=v.length-1|0,d=0;d<=f;++d)w[d/4|0]=w[d/4|0]|v.charCodeAt(d)<<(d%4<<3);var l=1+f|0;if(w[l/4|0]=w[l/4|0]|128<<(l%4<<3),55<l){h(b,w);for(var p=0;p<=15;++p)w[p]=0}return w[14]=i<<3,h(b,w),String.fromCharCode(255&b[0],b[0]>>8&255,b[0]>>16&255,b[0]>>24&255,255&b[1],b[1]>>8&255,b[1]>>16&255,b[1]>>24&255,255&b[2],b[2]>>8&255,b[2]>>16&255,b[2]>>24&255,255&b[3],b[3]>>8&255,b[3]>>16&255,b[3]>>24&255)}(r,0,r.length)}function G(r){r.idx=(r.idx+1|0)%55;var n=d(r.st,r.idx),e=1073741823&(d(r.st,(r.idx+24|0)%55)+(n^n>>>25&31)|0);return f(r.st,r.idx,e),e}var C={st:[987910699,495797812,364182224,414272206,318284740,990407751,383018966,270373319,840823159,24560019,536292337,512266505,189156120,730249596,143776328,51606627,140166561,366354223,1003410265,700563762,981890670,913149062,526082594,1021425055,784300257,667753350,630144451,949649812,48546892,415514493,258888527,511570777,89983870,283659902,308386020,242688715,482270760,865188196,1027664170,207196989,193777847,619708188,671350186,149669678,257044018,87658204,558145612,183450813,28133145,901332182,710253903,510646120,652377910,409934019,801085050],idx:0};function I(r){return function(r,n){if(1073741823<n||n<=0)throw{RE_EXN_ID:"Invalid_argument",_1:"Random.int",Error:new Error};for(;;){var e=G(r),t=e%n;if((e-t|0)<=(1+(1073741823-n|0)|0))return t}}(C,r)}function S(){return 0==(1&G(C))}function M(r){return function(r,n){for(var e=0===n.length?[0]:n,t=e.length,i=0;i<=54;++i)f(r.st,i,i);for(var o,a,u,s="x",c=0,v=54+(t<55?55:t)|0;c<=v;++c){var _=c%55;a=s,u=d(e,c%t),s=E(a+String(u)),f(r.st,_,1073741823&(d(r.st,_)^(((k(o=s,0)+(k(o,1)<<8)|0)+(k(o,2)<<16)|0)+(k(o,3)<<24)|0)))}r.idx=0}(C,r)}function z(){return M([(4294967295^(0|Date.now()))*Math.random()|0])}function N(r,n,e){var t=n.params.src_offset,i=n.params.frame_size,o=i[0],a=n.params.frame_size,u=t[0]+n.frame.contents*o;return r.drawImage(n.img,u,t[1],o,i[1],e[0],e[1],a[0],a[1])}function P(r,n){if(0===n)throw{RE_EXN_ID:"Division_by_zero",Error:new Error};return r%n}function X(r,n,e,t,i,o,a){var u=void 0!==n?n:[0,0];return{max_frames:t,max_ticks:i,img_src:"./sprites/"+e,frame_size:o,src_offset:a,bbox_offset:void 0!==r?r:[0,0],bbox_size:l(u,[0,0])?o:u}}function D(r){var n=r[1];switch(r[0]){case 0:return X([1,1],[14,14],"enemies.png",2,10,[16,16],[0,128]);case 1:return n?X([1,10],[11,16],"enemies.png",2,10,[16,27],[32,69]):X([4,10],[11,16],"enemies.png",2,10,[16,27],[0,69]);case 2:return n?X([1,10],[11,16],"enemies.png",2,10,[16,27],[32,5]):X([4,10],[11,16],"enemies.png",2,10,[16,27],[0,5]);case 3:return X([2,2],[12,13],"enemies.png",4,10,[16,16],[0,96]);case 4:return X([2,2],[12,13],"enemies.png",4,10,[16,16],[0,32])}}function F(r,n){return(r?function(r){var n=r[0];if(r[1])switch(n){case 0:return X([1,1],[11,15],"mario-small.png",1,0,[16,16],[0,32]);case 1:return X([2,1],[13,15],"mario-small.png",2,10,[16,16],[16,48]);case 2:return X([2,1],[12,15],"mario-small.png",3,5,[16,16],[16,32]);case 3:return X([1,5],[14,10],"mario-small.png",1,0,[16,16],[0,64])}else switch(n){case 0:return X([3,1],[11,15],"mario-small.png",1,0,[16,16],[0,0]);case 1:return X([2,1],[13,15],"mario-small.png",2,10,[16,16],[16,16]);case 2:return X([2,1],[12,15],"mario-small.png",3,5,[16,16],[16,0]);case 3:return X([1,5],[14,10],"mario-small.png",1,0,[16,16],[0,64])}}:function(r){var n=r[0];if(r[1])switch(n){case 0:return X([1,1],[13,25],"mario-big.png",1,0,[16,26],[16,69]);case 1:return X([2,1],[12,25],"mario-big.png",1,0,[16,26],[48,70]);case 2:return X([2,1],[13,25],"mario-big.png",4,10,[16,27],[0,101]);case 3:return X([2,10],[13,17],"mario-big.png",1,0,[16,27],[32,69])}else switch(n){case 0:return X([2,1],[13,25],"mario-big.png",1,0,[16,27],[16,5]);case 1:return X([2,1],[12,25],"mario-big.png",1,0,[16,26],[48,6]);case 2:return X([2,1],[13,25],"mario-big.png",4,10,[16,27],[0,37]);case 3:return X([2,10],[13,17],"mario-big.png",1,0,[16,27],[32,5])}})(n)}function q(r,n){switch(0|r.TAG){case 0:return F(r._0,[r._1,n]);case 1:return D([r._0,n]);case 2:return r._0?X([3,0],[12,16],"items.png",3,15,[16,16],[0,80]):X([2,0],[12,16],"items.png",1,0,[16,16],[0,0]);case 3:return function(r){if("number"!=typeof r)return X(void 0,void 0,"blocks.png",4,15,[16,16],[0,16]);switch(r){case 0:return X(void 0,void 0,"blocks.png",1,0,[16,16],[0,32]);case 1:return X(void 0,void 0,"blocks.png",5,10,[16,16],[0,0]);case 2:return X(void 0,void 0,"blocks.png",1,0,[16,16],[0,48]);case 3:return X(void 0,void 0,"blocks.png",1,0,[16,16],[0,64]);case 4:return X(void 0,void 0,"panel.png",3,15,[26,26],[0,0]);case 5:return X(void 0,void 0,"ground.png",1,0,[16,16],[0,32])}}(r._0)}}function L(r){var n=document.createElement("img");return n.src=r.img_src,{params:r,frame:{contents:0},ticks:{contents:0},img:n}}function O(r,n){return L(q(r,n))}function Y(r){return L(function(r){switch(r){case 0:return X(void 0,void 0,"enemies.png",1,0,[16,16],[0,144]);case 1:return X(void 0,void 0,"chunks.png",1,0,[8,8],[0,0]);case 2:return X(void 0,void 0,"chunks.png",1,0,[8,8],[8,0]);case 3:return X(void 0,void 0,"score.png",1,0,[12,8],[0,0]);case 4:return X(void 0,void 0,"score.png",1,0,[12,9],[0,9]);case 5:return X(void 0,void 0,"score.png",1,0,[12,9],[0,18]);case 6:return X(void 0,void 0,"score.png",1,0,[12,9],[0,27]);case 7:return X(void 0,void 0,"score.png",1,0,[14,9],[13,0]);case 8:return X(void 0,void 0,"score.png",1,0,[14,9],[13,9]);case 9:return X(void 0,void 0,"score.png",1,0,[14,9],[13,18]);case 10:return X(void 0,void 0,"score.png",1,0,[14,9],[13,27])}}(r))}function B(r){return{x:r[0],y:r[1]}}function V(r,n,e,t){var i,o=void 0!==r?r:[0,0],a=void 0!==n?n:[0,0],u=2===(i=e)||1===i?{sprite:Y(i),lifetime:300}:{sprite:Y(i),lifetime:30};return{params:u,pos:B(t),vel:B(o),acc:B(a),kill:!1,life:u.lifetime}}function H(r,n){return V([.5,-.7],void 0,801<=r?2001<=r?4e3!==r?8e3!==r?3:10:9:1e3!==r?2e3<=r?8:3:7:201<=r?400!==r?800<=r?6:3:5:100!==r&&200<=r?4:3,n)}var J=function(r,n){r._1=n};function K(r,n){return function(r,n){for(;;){var e=r;if(!e)return;n(e._0),r=e._1}}(r,i(n)),0}function Q(r,n,e){return function(r,n,e){for(;;){var t=r;if(!t)return n;n=e(n,t._0),r=t._1}}(r,n,o(e))}function U(r,n){for(;;){if(!r)return 0;var e=r._1,t=r._0;if(n(t)){var i={_0:t,_1:0};return function(r,n,e){for(;;){var t=e;if(!n)return;var i,o=n._1,a=n._0;r(a)?(J(t,i={_0:a,_1:0}),e=i,n=o):n=o}}(n,e,i),i}r=e}}var W={contents:-2147483648};function Z(r,n){return{has_gravity:void 0===r||r,speed:void 0!==n?n:1}}function $(r){var n=r.params.speed,e=r.dir;r.vel.x=e?n:-n}function rr(r){switch(0|r.TAG){case 0:return Z(void 0,2.8);case 1:return Z(void 0,3<=r._0?3:void 0);case 2:return Z(!r._0&&void 0,void 0);case 3:return r._0,Z(!1,void 0)}}function nr(r,n,e){var t=void 0!==r?r:0,i=O(n,t),o=rr(n),a=(W.contents=W.contents+1|0,W.contents);return[i,{params:o,pos:{x:e.x,y:e.y},vel:{x:0,y:0},id:a,jumping:!1,grounded:!1,dir:t,invuln:0,kill:!1,health:1,crouch:!1,score:0}]}function er(r,n){var e=nr(void 0,r,n),t=e[1],i=e[0];switch(0|r.TAG){case 0:return{TAG:0,_0:r._0,_1:i,_2:t};case 1:return $(t),{TAG:1,_0:r._0,_1:i,_2:t};case 2:return{TAG:2,_0:r._0,_1:i,_2:t};case 3:return{TAG:3,_0:r._0,_1:i,_2:t}}}function tr(r){return r._2}function ir(r){return!r.TAG}function or(r,n,e){var t=n.bbox_offset,i=e.bbox_offset,o=n.bbox_size,a=e.bbox_size;r.x=r.x-(a[0]+i[0])+(o[0]+t[0]),r.y=r.y-(a[1]+i[1])+(o[1]+t[1])}function ar(n,r){var e=n.jumping,t=n.dir,i=Math.abs(n.vel.x);K(r,function(r){return function(r,n){var e=.2*r.vel.x;switch(n){case 0:return r.crouch?void 0:(r.vel.x>-r.params.speed&&(r.vel.x=r.vel.x-(.4-e)),void(r.dir=0));case 1:return r.crouch?void 0:(r.vel.x<r.params.speed&&(r.vel.x=r.vel.x+(.4+e)),void(r.dir=1));case 2:return!r.jumping&&r.grounded?(r.jumping=!0,r.grounded=!1,void(r.vel.y=v(r.vel.y-(5.7+.25*Math.abs(r.vel.x)),-6))):void 0;case 3:return!r.jumping&&r.grounded?void(r.crouch=!0):void 0}}(n,r)});var o=.9*n.vel.x,a=Math.abs(o)<.1?0:o;n.vel.x=a;var u=n.health<=1?1:0;return!e&&n.jumping?[u,O({TAG:0,_0:u,_1:1},n.dir)]:t!==n.dir||0===i&&0<Math.abs(n.vel.x)&&!n.jumping?[u,O({TAG:0,_0:u,_1:2},n.dir)]:t!==n.dir&&n.jumping&&e?[u,O({TAG:0,_0:u,_1:1},n.dir)]:0===n.vel.y&&n.crouch?[u,O({TAG:0,_0:u,_1:3},n.dir)]:0===n.vel.y&&0===n.vel.x?[u,O({TAG:0,_0:u,_1:0},n.dir)]:void 0}function ur(r,n){var e,t;(e=r).grounded?e.vel.y=0:e.params.has_gravity&&(e.vel.y=a(e.vel.y+.2+.01*Math.abs(e.vel.y),4.5)),(t=r).pos.x=t.vel.x+t.pos.x,t.params.has_gravity&&(t.pos.y=t.vel.y+t.pos.y),r.pos.y>n&&(r.kill=!0)}function sr(r,n){1!==r?0!==r?n.vel.x=0:n.vel.y=-.001:(n.vel.y=0,n.grounded=!0,n.jumping=!1)}function cr(r){r.vel.x=-r.vel.x,r.dir=r.dir?0:1}function vr(r,n,e,t){switch(n){case 0:return void(t.kill=!0);case 1:var i=nr(t.dir,{TAG:1,_0:3},t.pos),o=i[1],a=i[0];return or(o.pos,e.params,a.params),{TAG:1,_0:3,_1:a,_2:o};case 2:var u=nr(t.dir,{TAG:1,_0:4},t.pos),s=u[1],c=u[0];return or(s.pos,e.params,c.params),{TAG:1,_0:4,_1:c,_2:s}}t.dir=r,0!==t.vel.x?t.vel.x=0:$(t)}function _r(r,n,e){cr(r);var t,i,o,a,u,s=e.params;return t=n,i=e,o=r.dir,a=D([t,o]),(u=document.createElement("img")).src=a.img_src,i.params=a,i.img=u,or(r.pos,s,e.params),0}function fr(r){var n=r.health-1|0;return 0==n?void(r.kill=!0):0===r.invuln&&void(r.health=n)}function dr(r){fr(r);var n=nr(void 0,{TAG:3,_0:0},r.pos);return{TAG:3,_0:0,_1:n[0],_2:n[1]}}function lr(r,n,e){var t=er({TAG:2,_0:e},n.pos),i=t._2;return i.pos.y=i.pos.y-t._1.params.frame_size[1],i.dir=r?0:1,$(i),t}function pr(r){var n=r._1.params,e=r._2,t=n.bbox_offset,i=e.pos.x+t[0],o=e.pos.y+t[1],a=n.bbox_size,u=a[1],s=a[0];return{center:{x:i+s/2,y:o+u/2},half:{x:s/2,y:u/2}}}function xr(r,n){var e=pr(r),t=pr(n),i=r._2;if(!function(r,n){var e,t=r._2,i=n._2;switch(0|r.TAG){case 0:e=1===n.TAG&&0<r._2.invuln;break;case 1:e=2===n.TAG;break;case 2:switch(0|n.TAG){case 1:case 2:e=!0;break;case 0:case 3:e=!1}break;case 3:e=!1}return t.kill||i.kill||e}(r,n)){var o=e.center.x-t.center.x,a=e.center.y-t.center.y,u=e.half.x+t.half.x,s=e.half.y+t.half.y;if(Math.abs(o)<u&&Math.abs(a)<s){var c=u-Math.abs(o),v=s-Math.abs(a);return v<=c?0<a?(i.pos.y=i.pos.y+v,0):(i.pos.y=i.pos.y-v,1):0<o?(i.pos.x=i.pos.x+c,3):(i.pos.x=i.pos.x-c,2)}}}var mr=4,yr=60;function gr(r){return r.pos}function hr(r,n,e){var t=n/2;return a(v(r-t,0),a(e-n,Math.abs(r-t)))}function br(r,n){var e=r.pos.x-32,t=r.pos.x+r.v_dim.x,i=r.pos.y-32,o=r.pos.y+r.v_dim.y,a=n.x,u=n.y;return e<=a&&a<=t&&i<=u&&u<=o}function wr(r,n){return r.pos.y+r.v_dim.y<=n}function kr(r,n){return{pos:{x:hr(n.x,r.v_dim.x,r.m_dim.x),y:hr(n.y,r.v_dim.y,r.m_dim.y)},v_dim:r.v_dim,m_dim:r.m_dim}}function Ar(r,n){for(;;){var e=n;if(!e)return;if(l(r,e._0[1]))return 1;n=e._1}}function Tr(r,n){for(;;){if(!r)return 0;var e=r._1,t=r._0;if(!Ar(t[1],n))return{_0:t,_1:Tr(e,n)};r=e}}function Er(r,n,e){for(;;){if(!r)return 0;var t=r._1,i=r._0,o=i[1].x,a=i[1].y;if(!(o<128||16*n-o<528||0===a||16*e-a<48))return T({_0:i,_1:0},Er(t,n,e));r=t}}function Gr(){var r=I(3);return 0!==r?1!==r?0:1:2}function Cr(r,n,e,t,i){if(r<e||n<t)return 0;var o,a,u,s,c,v,_,f,d,l=S()?2:1,p=0===I(5)?{_0:0}:l;switch(i){case 0:return{_0:[l,{x:e,y:t}],_1:{_0:[p,{x:e+1,y:t}],_1:{_0:[l,{x:e+2,y:t}],_1:0}}};case 1:var x=I(5)+5|0;return t<5?function r(n,e,t,i){return 0===i?0:T({_0:[t,{x:n,y:e}],_1:0},r(n+1,e,t,i-1|0))}(e,t,3,x):0;case 2:return n-t==1?T({_0:[d=l,{x:_=e,y:f=t}],_1:{_0:[d,{x:_+1,y:f}],_1:{_0:[d,{x:_+2,y:f}],_1:{_0:[d,{x:_+3,y:f}],_1:0}}}},T({_0:[d,{x:_+1,y:f-1}],_1:{_0:[d,{x:_+2,y:f-1}],_1:{_0:[d,{x:_+3,y:f-1}],_1:0}}},T({_0:[d,{x:_+2,y:f-2}],_1:{_0:[d,{x:_+3,y:f-2}],_1:0}},{_0:[d,{x:_+3,y:f-3}],_1:0}))):0;case 3:return 1==l&&3<n-t?T({_0:[v=l,{x:s=e,y:c=t}],_1:{_0:[v,{x:s+1,y:c}],_1:{_0:[v,{x:s+2,y:c}],_1:0}}},T({_0:[v,{x:s+2,y:c+1}],_1:{_0:[v,{x:s+3,y:c+1}],_1:0}},{_0:[v,{x:s+5,y:c+2}],_1:{_0:[v,{x:s+6,y:c+2}],_1:0}})):2<n-t?T({_0:[u=l,{x:o=e,y:a=t}],_1:{_0:[u,{x:o+1,y:a}],_1:0}},T({_0:[u,{x:o+3,y:a-1}],_1:{_0:[u,{x:o+4,y:a-1}],_1:0}},{_0:[u,{x:o+4,y:a-2}],_1:{_0:[u,{x:o+5,y:a-2}],_1:{_0:[u,{x:o+6,y:a-2}],_1:0}}})):{_0:[l,{x:e,y:t}],_1:0};case 4:return t+3-n==2?{_0:[l,{x:e,y:t}],_1:0}:t+3-n==1?{_0:[l,{x:e,y:t}],_1:{_0:[l,{x:e,y:t+1}],_1:0}}:{_0:[l,{x:e,y:t}],_1:{_0:[l,{x:e,y:t+1}],_1:{_0:[l,{x:e,y:t+2}],_1:0}}};default:return A("Shouldn't reach here")}}function Ir(r){if(!r)return 0;var n=r._0;return T({_0:er({TAG:3,_0:n[0]},n[1]),_1:0},Ir(r._1))}function Sr(r){if(!r)return 0;var n=r._0;return T({_0:er({TAG:1,_0:n[0]},n[1]),_1:0},Sr(r._1))}function Mr(r,n){var e=function(r,n,e,t,i){for(;;){var o,a=i,u=t,s=e;if(r-s<33)return a;n-1<u?(t=0,e=s+1):t=(Ar({x:s,y:u},a)||0===u||(o=I(100))<5&&(i=T(a,Tr(Cr(r,n,s,u,o),a))),u+1)}}(r,n,0,0,0),t=Er(function r(n){if(!n)return 0;var e=n._0,t=e[1];return T({_0:[e[0],{x:16*t.x,y:16*t.y}],_1:0},r(n._1))}(e),r,n),i=Ir(t),o=function(r,n,e,t){for(;;){var i=t,o=e;if(r<o)return i;if(10<o){var a=I(10),u=T(i,{_0:[5,{x:16*o,y:16*n}],_1:0});if(7===a&&32<r-o){e=o+1;continue}t=u,e=o+1}else{t=T(i,{_0:[5,{x:16*o,y:16*n}],_1:0}),e=o+1}}}(r,n,0,0),a=Ir(o),u=T(e,o),s=T(i,a),c=Sr(function r(n,e,t,i,o){for(;;){var a=i,u=t;if(n-32<u)return 0;if(e-1<a||u<15)i=0,t=u+1;else if(Ar({x:u,y:a},o)||0===a)i=a+1;else{if(0===I(10)&&e-1===a)return T({_0:[Gr(),{x:16*u,y:16*a}],_1:0},r(n,e,u,a+1,o));i=a+1}}}(r,n,0,0,u)),v=function r(n){for(;;){var e=n,t=I(2);if(!e)return 0;var i=e._1,o=e._0[1];if(0===t)return T({_0:[{_0:1},{x:o.x,y:o.y-16}],_1:0},r(i));n=i}}(t),_=Er(Tr(v,t),r,n),f=Sr(Tr(Tr(function r(n){for(;;){var e=n,t=I(20),i=Gr();if(!e)return 0;var o=e._1,a=e._0;if(0===t)return T({_0:[i,{x:a[1].x,y:a[1].y-16}],_1:0},r(o));n=o}}(t),t),v)),d=function r(n){return n?T({_0:er({TAG:2,_0:1},n._0[1]),_1:0},r(n._1)):0}(_);return T(s,T(c,T(d,T(f,{_0:er({TAG:3,_0:4},{x:16*r-256,y:16*n*2/3}),_1:0}))))}function zr(){var r=Mr(n/16,t/16-1);return[er({TAG:0,_0:1,_1:0},{x:100,y:224}),r]}var Dr={left:!1,right:!1,up:!1,down:!1,bbox:0},Rr={contents:0},jr={contents:0},Nr={contents:0};function Pr(r,n){r.score=r.score+n|0}function Xr(r,n,e,t,i){if(r.invuln=10,r.jumping=!1,r.grounded=!0,3<=n){var o=vr(r.dir,n,e,t);return r.vel.y=-mr,r.pos.y=r.pos.y-5,[void 0,o]}if(fr(t),r.vel.y=-mr,8===i.multiplier)return Pr(i,800),t.score=800,[void 0,vr(r.dir,n,e,t)];var a=Math.imul(100,i.multiplier);return Pr(i,a),t.score=a,i.multiplier=i.multiplier<<1,[void 0,vr(r.dir,n,e,t)]}function Fr(r,n,e,t){return 3<=n?[void 0,0===t.vel.x?vr(r.dir,n,e,t):(fr(r),void(r.invuln=yr))]:(fr(r),r.invuln=yr,[void 0,void 0])}function qr(r,n,e,t){var i,o,a;switch(0|n.TAG){case 0:var u=n._2;switch(0|e.TAG){case 0:return[void 0,void 0];case 1:var s=e._2,c=e._1,v=e._0;return 1!==r?Fr(u,v,c,s):Xr(u,v,c,s,t);case 2:i=u,o=e._0,a=e._2;break;case 3:var _=e._2,f=e._0;if(0!==r){return"number"==typeof f&&4===f?(t.status=1,[void 0,void 0]):(1!==r||(t.multiplier=1),sr(r,u),[void 0,void 0])}if("number"==typeof f)return 1!==f?4!==f?sr(r,u):t.status=1:0===n._0?(sr(r,u),fr(_)):sr(r,u),[void 0,void 0];var d=dr(_),l=lr(u.dir,_,f._0);return sr(r,u),[l,d]}break;case 1:var p=n._2,x=n._1,m=n._0;switch(0|e.TAG){case 0:var y=e._2;return 0!==r?Fr(y,m,x,p):Xr(y,m,x,p,t);case 1:return function(r,n,e,t,i,o,a){if(3!==r){if(r<4)return 3<=t?0===o.vel.x?_r(e,r,n):fr(e):2<=a&&(_r(e,r,n),_r(o,t,i)),[void 0,void 0];if(3<=t)return fr(e),fr(o),[void 0,void 0]}else if(3<=t)return fr(e),fr(o),[void 0,void 0];return 0===e.vel.x?_r(o,t,i):fr(o),[void 0,void 0]}(m,x,p,e._0,e._1,e._2,r);case 2:return[void 0,void 0];case 3:var g=e._2,h=e._0;if(2<=r){if(3<=m){if("number"==typeof h)return 1!==h?_r(p,m,x):(fr(g),cr(p)),[void 0,void 0];var b=dr(g),w=lr(p.dir,g,h._0);return _r(p,m,x),[b,w]}return _r(p,m,x),[void 0,void 0]}return sr(r,p),[void 0,void 0]}case 2:var k=n._2;switch(0|e.TAG){case 0:i=e._2,o=n._0,a=k;break;case 1:case 2:return[void 0,void 0];case 3:return 2<=r?cr(k):sr(r,k),[void 0,void 0]}break;case 3:return[void 0,void 0]}return o?(t.coins=t.coins+1|0,fr(a),Pr(t,100)):(fr(a),2===i.health||(i.health=i.health+1|0),i.vel.x=0,i.vel.y=0,Pr(t,1e3),a.score=1e3),[void 0,void 0]}function Lr(n,r,e){var t=tr(n);return U(r,i(function(r){return!(!br(e.vpt,t.pos)&&!ir(n))||wr(e.vpt,t.pos.y)}))}function Or(r,n,e){return 3===r.TAG?0:function(r,n,e){for(var t,i=n,o=0;;){var a=o,u=i;if(!u)return a;var s,c,v=u._0,_=tr(r);t=v;var f,d,l=(c=r._2.id!==t._2.id&&void 0!==(s=xr(r,v))&&tr(v).id!==_.id?qr(s,r,v,e):[void 0,void 0])[0],o=void 0!==l?void 0!==(f=c[1])?{_0:l,_1:{_0:f,_1:a}}:{_0:l,_1:a}:void 0!==(d=c[1])?{_0:d,_1:a}:a,i=u._1}}(r,Lr(r,n,e),e)}function Yr(r,n,e){var t=tr(n),i=n._1;t.invuln=0<t.invuln?t.invuln-1|0:0;var o=br(r.vpt,t.pos)||ir(n)||wr(r.vpt,t.pos.y);if(t.kill||!o)return 0;t.grounded=!1,ur(t,r.map);var a,u,s,c,v,_,f,d,l,p=Or(n,e,r),x=(a=r.vpt,{x:(u=t.pos).x-a.pos.x,y:u.y-a.pos.y});return N(r.ctx,i,[x.x,x.y]),1===Dr.bbox&&(s=r.ctx,v=[x.x,x.y],_=(c=i).params.bbox_offset,f=c.params.bbox_size,s.strokeStyle="#FF0000",s.strokeRect(v[0]+_[0],v[1]+_[1],f[0],f[1])),0===t.vel.x&&1===n.TAG||((l=(d=i).ticks.contents)>=d.params.max_ticks?(d.ticks.contents=0,d.frame.contents=P(d.frame.contents+1|0,d.params.max_frames)):d.ticks.contents=l+1|0),p}function Br(r,n,e){if(n.TAG){var t=tr(n),i=Yr(r,n,e);t.kill||(Rr.contents={_0:n,_1:T(Rr.contents,i)});var o=t.kill?function(r){switch(0|r.TAG){case 0:return 0;case 1:var n=r._2,e=[n.pos.x,n.pos.y];return T(0<n.score?{_0:H(n.score,e),_1:0}:0,0!==r._0?0:{_0:V(void 0,void 0,0,e),_1:0});case 2:var t=r._2;return r._0?0:{_0:H(t.score,[t.pos.x,t.pos.y]),_1:0};case 3:var i=r._2,o=r._0;if("number"!=typeof o)return 0;if(1!==o)return 0;var a=[i.pos.x,i.pos.y];return{_0:V([-5,-5],[0,.2],1,a),_1:{_0:V([-3,-4],[0,.2],1,a),_1:{_0:V([3,-4],[0,.2],2,a),_1:{_0:V([5,-5],[0,.2],2,a),_1:0}}}}}}(n):0;return jr.contents=T(jr.contents,o),n}var a=n._2,u=Q({_0:[Dr.left,0],_1:{_0:[Dr.right,1],_1:{_0:[Dr.up,2],_1:{_0:[Dr.down,3],_1:0}}}},0,function(r,n){return n[0]?{_0:n[1],_1:r}:r});a.crouch=!1;var s,c=ar(a,u),v=void 0!==c?(s=c[1],or(a.pos,n._1.params,s.params),{TAG:0,_0:c[0],_1:s,_2:a}):n,_=Yr(r,v,e);return Rr.contents=T(Rr.contents,_),v}function Vr(z,r){var n,e,t=r[0],i=z.getContext("2d"),o=+z.width,a=+z.height,u=(e=c,{pos:{x:0,y:0},v_dim:{x:(n=[o,a])[0],y:n[1]},m_dim:{x:e[0],y:e[1]}}),s={bgd:L(X(void 0,void 0,"bgd-1.png",1,0,[512,256],[0,0])),ctx:i,vpt:kr(u,tr(t).pos),map:c[1],score:0,coins:0,multiplier:1,status:0};s.ctx.scale(1,1);var D=function(r,n,e,t,i){var o,a,u,s=n.status;if("number"==typeof s){if(0!==s)return(u=n.ctx).rect(0,0,512,512),u.fillStyle="black",u.fill(),u.fillStyle="white",u.font="20px 'Press Start 2P'",u.fillText("You win!",180,128)}else{var c=s._0;if(R<r-c){var v=j-((r-c|0)/1e3|0)|0;if(0<v)return o=n.ctx,a=v,o.rect(0,0,512,512),o.fillStyle="black",o.fill(),o.fillStyle="white",o.font="20px 'Press Start 2P'",o.fillText("GAME OVER. You lose! ",60,100),o.fillText(String(a),230,150),void requestAnimationFrame(function(r){return D(r,n,e,Rr.contents,jr.contents)});var _=zr(n.ctx);return Vr(z,[_[0],_[1]])}}Rr.contents=0,jr.contents=0;var f,d,l,p,x,m=(f=Nr.contents,1/((r-f)/1e3));Nr.contents=r,l=(d=z).getContext("2d"),p=d.width,x=d.height,l.clearRect(0,0,p,x);var y,g,h,b=gr(n.vpt).x/5|0,w=0|n.bgd.params.frame_size[0];y=n.ctx,g=n.bgd,h=P(b,w),N(y,g,[-h,0]),N(y,g,[g.params.frame_size[0]-h,0]);var k=Br(n,e,t);!0===tr(k).kill&&"number"==typeof n.status&&(n.status={_0:r});var A,T,E,G,C,I,S,M={bgd:n.bgd,ctx:n.ctx,vpt:kr(n.vpt,tr(k).pos),map:n.map,score:n.score,coins:n.coins,multiplier:n.multiplier,status:n.status};K(t,function(r){return Br(M,r,t)}),K(i,function(r){return function(r,n){var e,t,i;(e=n).life=e.life-1|0,0===e.life&&(e.kill=!0),(t=e).vel.x=t.vel.x+t.acc.x,t.vel.y=t.vel.y+t.acc.y,(i=e).pos.x=i.vel.x+i.pos.x,i.pos.y=i.vel.y+i.pos.y;var o=n.pos.x-gr(r.vpt).x,a=n.pos.y-gr(r.vpt).y;N(r.ctx,n.params.sprite,[o,a]),n.kill||(jr.contents={_0:n,_1:jr.contents})}(M,r)}),A=z,T=String(0|m),A.getContext("2d").fillText(T,10,18),E=z,G=M.coins,C=String(M.score),I=String(G),(S=E.getContext("2d")).font="10px 'Press Start 2P'",S.fillText("Score: "+C,E.width-140,18),S.fillText("Coins: "+I,120,18),requestAnimationFrame(function(r){return D(r,M,k,Rr.contents,jr.contents)})};return D(0,s,t,r[1],0)}function Hr(r){var n=r.keyCode;if(41<=n)switch(n){case 65:Dr.left=!0;break;case 66:Dr.bbox=(Dr.bbox+1|0)%2;break;case 68:Dr.right=!0;break;case 83:Dr.down=!0;break;case 67:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 84:case 85:case 86:break;case 87:Dr.up=!0}else if(32<=n)switch(n-32|0){case 1:case 2:case 3:case 4:break;case 5:Dr.left=!0;break;case 0:case 6:Dr.up=!0;break;case 7:Dr.right=!0;break;case 8:Dr.down=!0}return!0}function Jr(r){var n=r.keyCode;if(68<=n)83!==n?87!==n?69<=n||(Dr.right=!1):Dr.up=!1:Dr.down=!1;else if(41<=n)65!==n||(Dr.left=!1);else if(32<=n)switch(n-32|0){case 1:case 2:case 3:case 4:break;case 5:Dr.left=!1;break;case 0:case 6:Dr.up=!1;break;case 7:Dr.right=!1;break;case 8:Dr.down=!1}return!0}function Kr(){z();var r=document.getElementById(e),n=null!==r?r:(console.log("cant find canvas "+e+" \n"),A("fail"));n.getContext("2d");return document.addEventListener("keydown",Hr,!0),document.addEventListener("keyup",Jr,!0),z(),Vr(n,zr())}function Qr(){var e={contents:0},t=r.length;return function(r,n){for(var e=0,t=r.length;e<t;++e)n(r[e])}(r,function(r){var n=document.createElement("img");n.src="sprites/"+r,n.addEventListener("load",function(r){return e.contents=e.contents+1|0,e.contents===t&&Kr(),!0},!0)}),0}window.onload=function(r){return Qr(),!0}}();
