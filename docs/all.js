!function(){"use strict";var r=["blocks.png","items.png","enemies.png","mario-small.png"],v=[2400,256],t="canvas",D=300,e=2400,i=256,R=5;function u(r,n,e){for(var t=new Array(e),i=0,o=n;i<e;)t[i]=r[o],i=i+1|0,o=o+1|0;return t}function f(r,n,e){if(n<0||n>=r.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};r[n]=e}function d(r,n){if(n<0||n>=r.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};return r[n]}function c(r,n){for(;;){var e=n,t=r,i=t.length,o=0===i?1:i,a=o-e.length|0;if(0==a)return t.apply(null,e);if(0<=a)return function(n,e){return function(r){return c(n,e.concat([r]))}}(t,e);n=u(e,o,0|-a),r=t.apply(null,u(e,0,o))}}function o(n){return 1===n.length?n:function(r){return function(a,u){var r=a.length;if(1===r)return a(u);switch(r){case 1:return a(u);case 2:return function(r){return a(u,r)};case 3:return function(r,n){return a(u,r,n)};case 4:return function(r,n,e){return a(u,r,n,e)};case 5:return function(r,n,e,t){return a(u,r,n,e,t)};case 6:return function(r,n,e,t,i){return a(u,r,n,e,t,i)};case 7:return function(r,n,e,t,i,o){return a(u,r,n,e,t,i,o)};default:return c(a,[u])}}(n,r)}}function a(e){return 2===e.length?e:function(r,n){return function(o,a,u){var r=o.length;if(2===r)return o(a,u);switch(r){case 1:return c(o(a),[u]);case 2:return o(a,u);case 3:return function(r){return o(a,u,r)};case 4:return function(r,n){return o(a,u,r,n)};case 5:return function(r,n,e){return o(a,u,r,n,e)};case 6:return function(r,n,e,t){return o(a,u,r,n,e,t)};case 7:return function(r,n,e,t,i){return o(a,u,r,n,e,t,i)};default:return c(o,[a,u])}}(e,r,n)}}function s(r,n){return r<n?r:n}function _(r,n){return n<r?r:n}var l=function(r,n){for(var e in r)n(e)};function p(n,e){if(n===e)return 1;var r=typeof n;if("string"!=r&&"number"!=r&&"boolean"!=r&&"undefined"!=r&&null!==n){var t=typeof e;if("function"==r||"function"==t)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: functional value",Error:new Error};if("number"!=t&&"undefined"!=t&&null!==e){var i=0|n.TAG,o=0|e.TAG;if(248==i)return n[1]===e[1];if(251==i)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: abstract value",Error:new Error};if(i==o){if(256==i)return n[1]===e[1];var a=0|n.length;if(a==(0|e.length)){if(!Array.isArray(n)){if(n instanceof Date&&e instanceof Date)return!(e<n||n<e);var u={contents:!0};return l(n,function(r){e.hasOwnProperty(r)||(u.contents=!1)}),u.contents&&l(e,function(r){n.hasOwnProperty(r)&&p(e[r],n[r])||(u.contents=!1)}),u.contents}for(var c=0;;){var s=c;if(s===a)return 1;if(!p(n[s],e[s]))return;c=s+1|0}}}}}}function x(r,n,e,t,i,o){var a=((n+r|0)+t|0)+o|0;return(a<<i|a>>>(32-i|0)|0)+e|0}function m(r,n,e,t,i,o,a){return x(n&e|(-1^n)&t,r,n,i,o,a)}function y(r,n,e,t,i,o,a){return x(n&t|e&(-1^t),r,n,i,o,a)}function g(r,n,e,t,i,o,a){return x(n^e^t,r,n,i,o,a)}function h(r,n,e,t,i,o,a){return x(e^(n|-1^t),r,n,i,o,a)}function b(r,n){var e=m(e=r[0],o=r[1],i=r[2],t=r[3],n[0],7,-680876936),t=m(t,e,o,i,n[1],12,-389564586),i=m(i,t,e,o,n[2],17,606105819),o=m(o,i,t,e,n[3],22,-1044525330);e=m(e,o,i,t,n[4],7,-176418897),t=m(t,e,o,i,n[5],12,1200080426),i=m(i,t,e,o,n[6],17,-1473231341),o=m(o,i,t,e,n[7],22,-45705983),e=m(e,o,i,t,n[8],7,1770035416),t=m(t,e,o,i,n[9],12,-1958414417),i=m(i,t,e,o,n[10],17,-42063),o=m(o,i,t,e,n[11],22,-1990404162),e=m(e,o,i,t,n[12],7,1804603682),t=m(t,e,o,i,n[13],12,-40341101),i=m(i,t,e,o,n[14],17,-1502002290),e=y(e,o=m(o,i,t,e,n[15],22,1236535329),i,t,n[1],5,-165796510),t=y(t,e,o,i,n[6],9,-1069501632),i=y(i,t,e,o,n[11],14,643717713),o=y(o,i,t,e,n[0],20,-373897302),e=y(e,o,i,t,n[5],5,-701558691),t=y(t,e,o,i,n[10],9,38016083),i=y(i,t,e,o,n[15],14,-660478335),o=y(o,i,t,e,n[4],20,-405537848),e=y(e,o,i,t,n[9],5,568446438),t=y(t,e,o,i,n[14],9,-1019803690),i=y(i,t,e,o,n[3],14,-187363961),o=y(o,i,t,e,n[8],20,1163531501),e=y(e,o,i,t,n[13],5,-1444681467),t=y(t,e,o,i,n[2],9,-51403784),i=y(i,t,e,o,n[7],14,1735328473),e=g(e,o=y(o,i,t,e,n[12],20,-1926607734),i,t,n[5],4,-378558),t=g(t,e,o,i,n[8],11,-2022574463),i=g(i,t,e,o,n[11],16,1839030562),o=g(o,i,t,e,n[14],23,-35309556),e=g(e,o,i,t,n[1],4,-1530992060),t=g(t,e,o,i,n[4],11,1272893353),i=g(i,t,e,o,n[7],16,-155497632),o=g(o,i,t,e,n[10],23,-1094730640),e=g(e,o,i,t,n[13],4,681279174),t=g(t,e,o,i,n[0],11,-358537222),i=g(i,t,e,o,n[3],16,-722521979),o=g(o,i,t,e,n[6],23,76029189),e=g(e,o,i,t,n[9],4,-640364487),t=g(t,e,o,i,n[12],11,-421815835),i=g(i,t,e,o,n[15],16,530742520),e=h(e,o=g(o,i,t,e,n[2],23,-995338651),i,t,n[0],6,-198630844),t=h(t,e,o,i,n[7],10,1126891415),i=h(i,t,e,o,n[14],15,-1416354905),o=h(o,i,t,e,n[5],21,-57434055),e=h(e,o,i,t,n[12],6,1700485571),t=h(t,e,o,i,n[3],10,-1894986606),i=h(i,t,e,o,n[10],15,-1051523),o=h(o,i,t,e,n[1],21,-2054922799),e=h(e,o,i,t,n[8],6,1873313359),t=h(t,e,o,i,n[15],10,-30611744),i=h(i,t,e,o,n[6],15,-1560198380),o=h(o,i,t,e,n[13],21,1309151649),e=h(e,o,i,t,n[4],6,-145523070),t=h(t,e,o,i,n[11],10,-1120210379),i=h(i,t,e,o,n[2],15,718787259),o=h(o,i,t,e,n[9],21,-343485551),r[0]=e+r[0]|0,r[1]=o+r[1]|0,r[2]=i+r[2]|0,r[3]=t+r[3]|0}var w=[1732584193,-271733879,-1732584194,271733878],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function A(r,n){if(n>=r.length||n<0)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};return r.charCodeAt(n)}function T(r){throw{RE_EXN_ID:"Failure",_1:r,Error:new Error}}function E(r,n){return r?{_0:r._0,_1:E(r._1,n)}:n}function G(r){return function(r,n,e){var t=r.slice(n,e),i=t.length;w[0]=1732584193,w[1]=-271733879,w[2]=-1732584194,w[3]=271733878;for(var o=0;o<=15;++o)k[o]=0;for(var a=i/64|0,u=1;u<=a;++u){for(var c=0;c<=15;++c){var s=((u<<6)-64|0)+(c<<2)|0;k[c]=((t.charCodeAt(s)+(t.charCodeAt(1+s|0)<<8)|0)+(t.charCodeAt(2+s|0)<<16)|0)+(t.charCodeAt(3+s|0)<<24)|0}b(w,k)}for(var v=t.slice(a<<6),_=0;_<=15;++_)k[_]=0;for(var f=v.length-1|0,d=0;d<=f;++d)k[d/4|0]=k[d/4|0]|v.charCodeAt(d)<<(d%4<<3);var l=1+f|0;if(k[l/4|0]=k[l/4|0]|128<<(l%4<<3),55<l){b(w,k);for(var p=0;p<=15;++p)k[p]=0}return k[14]=i<<3,b(w,k),String.fromCharCode(255&w[0],w[0]>>8&255,w[0]>>16&255,w[0]>>24&255,255&w[1],w[1]>>8&255,w[1]>>16&255,w[1]>>24&255,255&w[2],w[2]>>8&255,w[2]>>16&255,w[2]>>24&255,255&w[3],w[3]>>8&255,w[3]>>16&255,w[3]>>24&255)}(r,0,r.length)}function C(r){r.idx=(r.idx+1|0)%55;var n=d(r.st,r.idx),e=1073741823&(d(r.st,(r.idx+24|0)%55)+(n^n>>>25&31)|0);return f(r.st,r.idx,e),e}var n={st:[987910699,495797812,364182224,414272206,318284740,990407751,383018966,270373319,840823159,24560019,536292337,512266505,189156120,730249596,143776328,51606627,140166561,366354223,1003410265,700563762,981890670,913149062,526082594,1021425055,784300257,667753350,630144451,949649812,48546892,415514493,258888527,511570777,89983870,283659902,308386020,242688715,482270760,865188196,1027664170,207196989,193777847,619708188,671350186,149669678,257044018,87658204,558145612,183450813,28133145,901332182,710253903,510646120,652377910,409934019,801085050],idx:0};function I(r){return function(r,n){if(1073741823<n||n<=0)throw{RE_EXN_ID:"Invalid_argument",_1:"Random.int",Error:new Error};for(;;){var e=C(r),t=e%n;if((e-t|0)<=(1+(1073741823-n|0)|0))return t}}(n,r)}function S(){return 0==(1&C(n))}function M(r){return function(r,n){for(var e=0===n.length?[0]:n,t=e.length,i=0;i<=54;++i)f(r.st,i,i);for(var o,a,u,c="x",s=0,v=54+(t<55?55:t)|0;s<=v;++s){var _=s%55;a=c,u=d(e,s%t),c=G(a+String(u)),f(r.st,_,1073741823&(d(r.st,_)^(((A(o=c,0)+(A(o,1)<<8)|0)+(A(o,2)<<16)|0)+(A(o,3)<<24)|0)))}r.idx=0}(n,r)}function z(){return M([(4294967295^(0|Date.now()))*Math.random()|0])}function j(r,n){var e=r.context,t=r.params.src_offset,i=r.params.frame_size,o=i[0],a=r.params.frame_size,u=t[0]+r.frame.contents*o;return e.drawImage(r.img,u,t[1],o,i[1],n[0],n[1],a[0],a[1])}function N(r,n){if(0===n)throw{RE_EXN_ID:"Division_by_zero",Error:new Error};return r%n}function P(r,n,e,t,i,o,a){var u=void 0!==n?n:[0,0];return{max_frames:t,max_ticks:i,img_src:"./sprites/"+e,frame_size:o,src_offset:a,bbox_offset:void 0!==r?r:[0,0],bbox_size:p(u,[0,0])?o:u}}function X(r){var n=r[1];switch(r[0]){case 0:return P([1,1],[14,14],"enemies.png",2,10,[16,16],[0,128]);case 1:return n?P([1,10],[11,16],"enemies.png",2,10,[16,27],[32,69]):P([4,10],[11,16],"enemies.png",2,10,[16,27],[0,69]);case 2:return n?P([1,10],[11,16],"enemies.png",2,10,[16,27],[32,5]):P([4,10],[11,16],"enemies.png",2,10,[16,27],[0,5]);case 3:return P([2,2],[12,13],"enemies.png",4,10,[16,16],[0,96]);case 4:return P([2,2],[12,13],"enemies.png",4,10,[16,16],[0,32])}}function F(r,n){return(r?function(r){var n=r[0];if(r[1])switch(n){case 0:return P([1,1],[11,15],"mario-small.png",1,0,[16,16],[0,32]);case 1:return P([2,1],[13,15],"mario-small.png",2,10,[16,16],[16,48]);case 2:return P([2,1],[12,15],"mario-small.png",3,5,[16,16],[16,32]);case 3:return P([1,5],[14,10],"mario-small.png",1,0,[16,16],[0,64])}else switch(n){case 0:return P([3,1],[11,15],"mario-small.png",1,0,[16,16],[0,0]);case 1:return P([2,1],[13,15],"mario-small.png",2,10,[16,16],[16,16]);case 2:return P([2,1],[12,15],"mario-small.png",3,5,[16,16],[16,0]);case 3:return P([1,5],[14,10],"mario-small.png",1,0,[16,16],[0,64])}}:function(r){var n=r[0];if(r[1])switch(n){case 0:return P([1,1],[13,25],"mario-big.png",1,0,[16,26],[16,69]);case 1:return P([2,1],[12,25],"mario-big.png",1,0,[16,26],[48,70]);case 2:return P([2,1],[13,25],"mario-big.png",4,10,[16,27],[0,101]);case 3:return P([2,10],[13,17],"mario-big.png",1,0,[16,27],[32,69])}else switch(n){case 0:return P([2,1],[13,25],"mario-big.png",1,0,[16,27],[16,5]);case 1:return P([2,1],[12,25],"mario-big.png",1,0,[16,26],[48,6]);case 2:return P([2,1],[13,25],"mario-big.png",4,10,[16,27],[0,37]);case 3:return P([2,10],[13,17],"mario-big.png",1,0,[16,27],[32,5])}})(n)}function q(r,n){switch(0|r.TAG){case 0:return F(r._0,[r._1,n]);case 1:return X([r._0,n]);case 2:return r._0?P([3,0],[12,16],"items.png",3,15,[16,16],[0,80]):P([2,0],[12,16],"items.png",1,0,[16,16],[0,0]);case 3:return function(r){if("number"!=typeof r)return P(void 0,void 0,"blocks.png",4,15,[16,16],[0,16]);switch(r){case 0:return P(void 0,void 0,"blocks.png",1,0,[16,16],[0,32]);case 1:return P(void 0,void 0,"blocks.png",5,10,[16,16],[0,0]);case 2:return P(void 0,void 0,"blocks.png",1,0,[16,16],[0,48]);case 3:return P(void 0,void 0,"blocks.png",1,0,[16,16],[0,64]);case 4:return P(void 0,void 0,"panel.png",3,15,[26,26],[0,0]);case 5:return P(void 0,void 0,"ground.png",1,0,[16,16],[0,32])}}(r._0)}}function L(r,n){var e=document.createElement("img");return e.src=r.img_src,{params:r,context:n,frame:{contents:0},ticks:{contents:0},img:e}}function O(r,n,e){return L(q(r,n),e)}function Y(r,n){return L(function(r){switch(r){case 0:return P(void 0,void 0,"enemies.png",1,0,[16,16],[0,144]);case 1:return P(void 0,void 0,"chunks.png",1,0,[8,8],[0,0]);case 2:return P(void 0,void 0,"chunks.png",1,0,[8,8],[8,0]);case 3:return P(void 0,void 0,"score.png",1,0,[12,8],[0,0]);case 4:return P(void 0,void 0,"score.png",1,0,[12,9],[0,9]);case 5:return P(void 0,void 0,"score.png",1,0,[12,9],[0,18]);case 6:return P(void 0,void 0,"score.png",1,0,[12,9],[0,27]);case 7:return P(void 0,void 0,"score.png",1,0,[14,9],[13,0]);case 8:return P(void 0,void 0,"score.png",1,0,[14,9],[13,9]);case 9:return P(void 0,void 0,"score.png",1,0,[14,9],[13,18]);case 10:return P(void 0,void 0,"score.png",1,0,[14,9],[13,27])}}(r),n)}function B(r){return{x:r[0],y:r[1]}}function V(r,n,e,t,i){var o,a,u=void 0!==r?r:[0,0],c=void 0!==n?n:[0,0],s=(a=i,2===(o=e)||1===o?{sprite:Y(o,a),lifetime:300}:{sprite:Y(o,a),lifetime:30});return{params:s,pos:B(t),vel:B(u),acc:B(c),kill:!1,life:s.lifetime}}function H(r,n,e){return V([.5,-.7],void 0,801<=r?2001<=r?4e3!==r?8e3!==r?3:10:9:1e3!==r?2e3<=r?8:3:7:201<=r?400!==r?800<=r?6:3:5:100!==r&&200<=r?4:3,n,e)}var J=function(r,n){r._1=n};function K(r,n){return function(r,n){for(;;){var e=r;if(!e)return;n(e._0),r=e._1}}(r,o(n)),0}function Q(r,n,e){return function(r,n,e){for(;;){var t=r;if(!t)return n;n=e(n,t._0),r=t._1}}(r,n,a(e))}function U(r,n){for(;;){if(!r)return 0;var e=r._1,t=r._0;if(n(t)){var i={_0:t,_1:0};return function(r,n,e){for(;;){var t=e;if(!n)return;var i,o=n._1,a=n._0;r(a)?(J(t,i={_0:a,_1:0}),e=i,n=o):n=o}}(n,e,i),i}r=e}}var W={contents:-2147483648};function Z(r,n){return{has_gravity:void 0===r||r,speed:void 0!==n?n:1}}function $(r){var n=r.params.speed,e=r.dir;r.vel.x=e?n:-n}function rr(r){switch(0|r.TAG){case 0:return Z(void 0,2.8);case 1:return Z(void 0,3<=r._0?3:void 0);case 2:return Z(!r._0&&void 0,void 0);case 3:return r._0,Z(!1,void 0)}}function nr(r,n,e,t){var i=void 0!==r?r:0,o=O(n,i,e),a=rr(n),u=(W.contents=W.contents+1|0,W.contents);return[o,{params:a,pos:{x:t.x,y:t.y},vel:{x:0,y:0},id:u,jumping:!1,grounded:!1,dir:i,invuln:0,kill:!1,health:1,crouch:!1,score:0}]}function er(r,n,e){var t=nr(void 0,r,n,e),i=t[1],o=t[0];switch(0|r.TAG){case 0:return{TAG:0,_0:r._0,_1:o,_2:i};case 1:return $(i),{TAG:1,_0:r._0,_1:o,_2:i};case 2:return{TAG:2,_0:r._0,_1:o,_2:i};case 3:return{TAG:3,_0:r._0,_1:o,_2:i}}}function tr(r){return r._2}function ir(r){return!r.TAG}function or(r,n,e){var t=n.bbox_offset,i=e.bbox_offset,o=n.bbox_size,a=e.bbox_size;r.x=r.x-(a[0]+i[0])+(o[0]+t[0]),r.y=r.y-(a[1]+i[1])+(o[1]+t[1])}function ar(n,r,e){var t=n.jumping,i=n.dir,o=Math.abs(n.vel.x);K(r,function(r){return function(r,n){var e=.2*r.vel.x;switch(n){case 0:return r.crouch?void 0:(r.vel.x>-r.params.speed&&(r.vel.x=r.vel.x-(.4-e)),void(r.dir=0));case 1:return r.crouch?void 0:(r.vel.x<r.params.speed&&(r.vel.x=r.vel.x+(.4+e)),void(r.dir=1));case 2:return!r.jumping&&r.grounded?(r.jumping=!0,r.grounded=!1,void(r.vel.y=_(r.vel.y-(5.7+.25*Math.abs(r.vel.x)),-6))):void 0;case 3:return!r.jumping&&r.grounded?void(r.crouch=!0):void 0}}(n,r)});var a=.9*n.vel.x,u=Math.abs(a)<.1?0:a;n.vel.x=u;var c=n.health<=1?1:0;return!t&&n.jumping?[c,O({TAG:0,_0:c,_1:1},n.dir,e)]:i!==n.dir||0===o&&0<Math.abs(n.vel.x)&&!n.jumping?[c,O({TAG:0,_0:c,_1:2},n.dir,e)]:i!==n.dir&&n.jumping&&t?[c,O({TAG:0,_0:c,_1:1},n.dir,e)]:0===n.vel.y&&n.crouch?[c,O({TAG:0,_0:c,_1:3},n.dir,e)]:0===n.vel.y&&0===n.vel.x?[c,O({TAG:0,_0:c,_1:0},n.dir,e)]:void 0}function ur(r,n){var e,t;(e=r).grounded?e.vel.y=0:e.params.has_gravity&&(e.vel.y=s(e.vel.y+.2+.01*Math.abs(e.vel.y),4.5)),(t=r).pos.x=t.vel.x+t.pos.x,t.params.has_gravity&&(t.pos.y=t.vel.y+t.pos.y),r.pos.y>n&&(r.kill=!0)}function cr(r,n){1!==r?0!==r?n.vel.x=0:n.vel.y=-.001:(n.vel.y=0,n.grounded=!0,n.jumping=!1)}function sr(r){r.vel.x=-r.vel.x,r.dir=r.dir?0:1}function vr(r,n,e,t,i){switch(n){case 0:return void(t.kill=!0);case 1:var o=nr(t.dir,{TAG:1,_0:3},i,t.pos),a=o[1],u=o[0];return or(a.pos,e.params,u.params),{TAG:1,_0:3,_1:u,_2:a};case 2:var c=nr(t.dir,{TAG:1,_0:4},i,t.pos),s=c[1],v=c[0];return or(s.pos,e.params,v.params),{TAG:1,_0:4,_1:v,_2:s}}t.dir=r,0!==t.vel.x?t.vel.x=0:$(t)}function _r(r,n,e){sr(r);var t,i,o,a,u,c=e.params;return t=n,i=e,o=r.dir,a=X([t,o]),(u=document.createElement("img")).src=a.img_src,i.params=a,i.img=u,or(r.pos,c,e.params),0}function fr(r){var n=r.health-1|0;return 0==n?void(r.kill=!0):0===r.invuln&&void(r.health=n)}function dr(r,n){fr(r);var e=nr(void 0,{TAG:3,_0:0},n,r.pos);return{TAG:3,_0:0,_1:e[0],_2:e[1]}}function lr(r,n,e,t){var i=er({TAG:2,_0:e},t,n.pos),o=i._2;return o.pos.y=o.pos.y-i._1.params.frame_size[1],o.dir=r?0:1,$(o),i}function pr(r){var n=r._1.params,e=r._2,t=n.bbox_offset,i=e.pos.x+t[0],o=e.pos.y+t[1],a=n.bbox_size,u=a[1],c=a[0];return{center:{x:i+c/2,y:o+u/2},half:{x:c/2,y:u/2}}}function xr(r,n){var e=pr(r),t=pr(n),i=r._2;if(!function(r,n){var e,t=r._2,i=n._2;switch(0|r.TAG){case 0:e=1===n.TAG&&0<r._2.invuln;break;case 1:e=2===n.TAG;break;case 2:switch(0|n.TAG){case 1:case 2:e=!0;break;case 0:case 3:e=!1}break;case 3:e=!1}return t.kill||i.kill||e}(r,n)){var o=e.center.x-t.center.x,a=e.center.y-t.center.y,u=e.half.x+t.half.x,c=e.half.y+t.half.y;if(Math.abs(o)<u&&Math.abs(a)<c){var s=u-Math.abs(o),v=c-Math.abs(a);return v<=s?0<a?(i.pos.y=i.pos.y+v,0):(i.pos.y=i.pos.y-v,1):0<o?(i.pos.x=i.pos.x+s,3):(i.pos.x=i.pos.x-s,2)}}}var mr=4,yr=60;function gr(r){return r.pos}function hr(r,n,e){var t=n/2;return s(_(r-t,0),s(e-n,Math.abs(r-t)))}function br(r,n){var e=r.pos.x-32,t=r.pos.x+r.v_dim.x,i=r.pos.y-32,o=r.pos.y+r.v_dim.y,a=n.x,u=n.y;return e<=a&&a<=t&&i<=u&&u<=o}function wr(r,n){return r.pos.y+r.v_dim.y<=n}function kr(r,n){return{pos:{x:hr(n.x,r.v_dim.x,r.m_dim.x),y:hr(n.y,r.v_dim.y,r.m_dim.y)},v_dim:r.v_dim,m_dim:r.m_dim}}function Ar(r,n){for(;;){var e=n;if(!e)return;if(p(r,e._0[1]))return 1;n=e._1}}function Tr(r,n){for(;;){if(!r)return 0;var e=r._1,t=r._0;if(!Ar(t[1],n))return{_0:t,_1:Tr(e,n)};r=e}}function Er(r,n,e){for(;;){if(!r)return 0;var t=r._1,i=r._0,o=i[1].x,a=i[1].y;if(!(o<128||16*n-o<528||0===a||16*e-a<48))return E({_0:i,_1:0},Er(t,n,e));r=t}}function Gr(){var r=I(3);return 0!==r?1!==r?0:1:2}function Cr(r,n,e,t,i){if(r<e||n<t)return 0;var o,a,u,c,s,v,_,f,d,l=S()?2:1,p=0===I(5)?{_0:0}:l;switch(i){case 0:return{_0:[l,{x:e,y:t}],_1:{_0:[p,{x:e+1,y:t}],_1:{_0:[l,{x:e+2,y:t}],_1:0}}};case 1:var x=I(5)+5|0;return t<5?function r(n,e,t,i){return 0===i?0:E({_0:[t,{x:n,y:e}],_1:0},r(n+1,e,t,i-1|0))}(e,t,3,x):0;case 2:return n-t==1?E({_0:[d=l,{x:_=e,y:f=t}],_1:{_0:[d,{x:_+1,y:f}],_1:{_0:[d,{x:_+2,y:f}],_1:{_0:[d,{x:_+3,y:f}],_1:0}}}},E({_0:[d,{x:_+1,y:f-1}],_1:{_0:[d,{x:_+2,y:f-1}],_1:{_0:[d,{x:_+3,y:f-1}],_1:0}}},E({_0:[d,{x:_+2,y:f-2}],_1:{_0:[d,{x:_+3,y:f-2}],_1:0}},{_0:[d,{x:_+3,y:f-3}],_1:0}))):0;case 3:return 1==l&&3<n-t?E({_0:[v=l,{x:c=e,y:s=t}],_1:{_0:[v,{x:c+1,y:s}],_1:{_0:[v,{x:c+2,y:s}],_1:0}}},E({_0:[v,{x:c+2,y:s+1}],_1:{_0:[v,{x:c+3,y:s+1}],_1:0}},{_0:[v,{x:c+5,y:s+2}],_1:{_0:[v,{x:c+6,y:s+2}],_1:0}})):2<n-t?E({_0:[u=l,{x:o=e,y:a=t}],_1:{_0:[u,{x:o+1,y:a}],_1:0}},E({_0:[u,{x:o+3,y:a-1}],_1:{_0:[u,{x:o+4,y:a-1}],_1:0}},{_0:[u,{x:o+4,y:a-2}],_1:{_0:[u,{x:o+5,y:a-2}],_1:{_0:[u,{x:o+6,y:a-2}],_1:0}}})):{_0:[l,{x:e,y:t}],_1:0};case 4:return t+3-n==2?{_0:[l,{x:e,y:t}],_1:0}:t+3-n==1?{_0:[l,{x:e,y:t}],_1:{_0:[l,{x:e,y:t+1}],_1:0}}:{_0:[l,{x:e,y:t}],_1:{_0:[l,{x:e,y:t+1}],_1:{_0:[l,{x:e,y:t+2}],_1:0}}};default:return T("Shouldn't reach here")}}function Ir(r,n){if(!r)return 0;var e=r._0;return E({_0:er({TAG:3,_0:e[0]},n,e[1]),_1:0},Ir(r._1,n))}function Sr(r,n){if(!r)return 0;var e=r._0;return E({_0:er({TAG:1,_0:e[0]},n,e[1]),_1:0},Sr(r._1,n))}function Mr(r,n,e,t,i){var o=function(r,n,e,t,i){for(;;){var o,a=i,u=t,c=e;if(r-c<33)return a;n-1<u?(t=0,e=c+1):t=(Ar({x:c,y:u},a)||0===u||(o=I(100))<5&&(i=E(a,Tr(Cr(r,n,c,u,o),a))),u+1)}}(r,n,0,0,0),a=Er(function r(n){if(!n)return 0;var e=n._0,t=e[1];return E({_0:[e[0],{x:16*t.x,y:16*t.y}],_1:0},r(n._1))}(o),r,n),u=Ir(a,i),c=function(r,n,e,t){for(;;){var i=t,o=e;if(r<o)return i;if(10<o){var a=I(10),u=E(i,{_0:[5,{x:16*o,y:16*n}],_1:0});if(7===a&&32<r-o){e=o+1;continue}t=u,e=o+1}else{t=E(i,{_0:[5,{x:16*o,y:16*n}],_1:0}),e=o+1}}}(r,n,0,0),s=Ir(c,i),v=E(o,c),_=E(u,s),f=Sr(function r(n,e,t,i,o){for(;;){var a=i,u=t;if(n-32<u)return 0;if(e-1<a||u<15)i=0,t=u+1;else if(Ar({x:u,y:a},o)||0===a)i=a+1;else{if(0===I(10)&&e-1===a)return E({_0:[Gr(),{x:16*u,y:16*a}],_1:0},r(n,e,u,a+1,o));i=a+1}}}(r,n,0,0,v),i),d=function r(n){for(;;){var e=n,t=I(2);if(!e)return 0;var i=e._1,o=e._0[1];if(0===t)return E({_0:[{_0:1},{x:o.x,y:o.y-16}],_1:0},r(i));n=i}}(a),l=Er(Tr(d,a),r,n),p=Sr(Tr(Tr(function r(n){for(;;){var e=n,t=I(20),i=Gr();if(!e)return 0;var o=e._1,a=e._0;if(0===t)return E({_0:[i,{x:a[1].x,y:a[1].y-16}],_1:0},r(o));n=o}}(a),a),d),i),x=function r(n,e){return n?E({_0:er({TAG:2,_0:1},e,n._0[1]),_1:0},r(n._1,e)):0}(l,i);return E(_,E(f,E(x,E(p,{_0:er({TAG:3,_0:4},i,{x:16*r-256,y:16*n*2/3}),_1:0}))))}function zr(r){var n=Mr(e/16,i/16-1,0,0,r);return[er({TAG:0,_0:1,_1:0},r,{x:100,y:224}),n]}var Dr={left:!1,right:!1,up:!1,down:!1,bbox:0},Rr={contents:0},jr={contents:0},Nr={contents:0};function Pr(r,n){r.score=r.score+n|0}function Xr(r,n,e,t,i){return 3<=n?[void 0,0===t.vel.x?vr(r.dir,n,e,t,i):(fr(r),void(r.invuln=yr))]:(fr(r),r.invuln=yr,[void 0,void 0])}function Fr(r,n,e,t){var i,o,a,u,c,s,v,_=t.ctx,f=0;switch(0|n.TAG){case 0:var d=n._2;switch(0|e.TAG){case 0:return[void 0,void 0];case 1:var l=e._2,p=e._1,x=e._0;if(1!==r)return Xr(d,x,p,l,_);i=d,o=x,a=p,u=l,f=1;break;case 2:c=d,s=e._0,v=e._2,f=2;break;case 3:var m=e._2,y=e._0;if(0!==r){return"number"==typeof y&&4===y?(t.status=1,[void 0,void 0]):(1!==r||(t.multiplier=1),cr(r,d),[void 0,void 0])}if("number"==typeof y)return 1!==y?4!==y?cr(r,d):t.status=1:0===n._0?(cr(r,d),fr(m)):cr(r,d),[void 0,void 0];var g=dr(m,_),h=lr(d.dir,m,y._0,_);return cr(r,d),[h,g]}break;case 1:var b=n._2,w=n._1,k=n._0;switch(0|e.TAG){case 0:var A=e._2;if(0!==r)return Xr(A,k,w,b,_);i=A,o=k,a=w,u=b,f=1;break;case 1:return function(r,n,e,t,i,o,a){if(3!==r){if(r<4)return 3<=t?0===o.vel.x?_r(e,r,n):fr(e):2<=a&&(_r(e,r,n),_r(o,t,i)),[void 0,void 0];if(3<=t)return fr(e),fr(o),[void 0,void 0]}else if(3<=t)return fr(e),fr(o),[void 0,void 0];return 0===e.vel.x?_r(o,t,i):fr(o),[void 0,void 0]}(k,w,b,e._0,e._1,e._2,r);case 2:return[void 0,void 0];case 3:var T=e._2,E=e._0;if(2<=r){if(3<=k){if("number"==typeof E)return 1!==E?_r(b,k,w):(fr(T),sr(b)),[void 0,void 0];var G=dr(T,_),C=lr(b.dir,T,E._0,_);return _r(b,k,w),[G,C]}return _r(b,k,w),[void 0,void 0]}return cr(r,b),[void 0,void 0]}break;case 2:var I=n._2;switch(0|e.TAG){case 0:c=e._2,s=n._0,v=I,f=2;break;case 1:case 2:return[void 0,void 0];case 3:return 2<=r?sr(I):cr(r,I),[void 0,void 0]}break;case 3:return[void 0,void 0]}switch(f){case 1:return function(r,n,e,t,i,o){if(r.invuln=10,r.jumping=!1,r.grounded=!0,3<=n){var a=vr(r.dir,n,e,t,o);return r.vel.y=-mr,r.pos.y=r.pos.y-5,[void 0,a]}if(fr(t),r.vel.y=-mr,8===i.multiplier)return Pr(i,800),t.score=800,[void 0,vr(r.dir,n,e,t,o)];var u=Math.imul(100,i.multiplier);return Pr(i,u),t.score=u,i.multiplier=i.multiplier<<1,[void 0,vr(r.dir,n,e,t,o)]}(i,o,a,u,t,_);case 2:return s?(t.coins=t.coins+1|0,fr(v),Pr(t,100)):(fr(v),2===c.health||(c.health=c.health+1|0),c.vel.x=0,c.vel.y=0,Pr(t,1e3),v.score=1e3),[void 0,void 0]}}function qr(n,r,e){var t=tr(n);return U(r,o(function(r){return!(!br(e.vpt,t.pos)&&!ir(n))||wr(e.vpt,t.pos.y)}))}function Lr(r,n,e){return 3===r.TAG?0:function(r,n,e){for(var t,i=n,o=0;;){var a=o,u=i;if(!u)return a;var c,s,v=u._0,_=tr(r);t=v;var f,d,l=(s=r._2.id!==t._2.id&&void 0!==(c=xr(r,v))&&tr(v).id!==_.id?Fr(c,r,v,e):[void 0,void 0])[0],o=void 0!==l?void 0!==(f=s[1])?{_0:l,_1:{_0:f,_1:a}}:{_0:l,_1:a}:void 0!==(d=s[1])?{_0:d,_1:a}:a,i=u._1}}(r,qr(r,n,e),e)}function Or(r,n,e){var t=tr(n),i=n._1;t.invuln=0<t.invuln?t.invuln-1|0:0;var o=br(r.vpt,t.pos)||ir(n)||wr(r.vpt,t.pos.y);if(t.kill||!o)return 0;t.grounded=!1,ur(t,r.map);var a,u,c,s,v,_,f,d,l,p=Lr(n,e,r),x=(a=r.vpt,{x:(u=t.pos).x-a.pos.x,y:u.y-a.pos.y});return j(i,[x.x,x.y]),1===Dr.bbox&&(s=[x.x,x.y],v=(c=i).context,_=c.params.bbox_offset,f=c.params.bbox_size,v.strokeStyle="#FF0000",v.strokeRect(s[0]+_[0],s[1]+_[1],f[0],f[1])),0===t.vel.x&&1===n.TAG||((l=(d=i).ticks.contents)>=d.params.max_ticks?(d.ticks.contents=0,d.frame.contents=N(d.frame.contents+1|0,d.params.max_frames)):d.ticks.contents=l+1|0),p}function Yr(r,n,e){if(n.TAG){var t=tr(n),i=Or(r,n,e);t.kill||(Rr.contents={_0:n,_1:E(Rr.contents,i)});var o=t.kill?function(r,n){switch(0|r.TAG){case 0:return 0;case 1:var e=r._2,t=[e.pos.x,e.pos.y];return E(0<e.score?{_0:H(e.score,t,n),_1:0}:0,0!==r._0?0:{_0:V(void 0,void 0,0,t,n),_1:0});case 2:var i=r._2;return r._0?0:{_0:H(i.score,[i.pos.x,i.pos.y],n),_1:0};case 3:var o=r._2,a=r._0;if("number"!=typeof a)return 0;if(1!==a)return 0;var u=[o.pos.x,o.pos.y];return{_0:V([-5,-5],[0,.2],1,u,n),_1:{_0:V([-3,-4],[0,.2],1,u,n),_1:{_0:V([3,-4],[0,.2],2,u,n),_1:{_0:V([5,-5],[0,.2],2,u,n),_1:0}}}}}}(n,r.ctx):0;return jr.contents=E(jr.contents,o),n}var a=n._2,u=Q({_0:[Dr.left,0],_1:{_0:[Dr.right,1],_1:{_0:[Dr.up,2],_1:{_0:[Dr.down,3],_1:0}}}},0,function(r,n){return n[0]?{_0:n[1],_1:r}:r});a.crouch=!1;var c,s=ar(a,u,r.ctx),v=void 0!==s?(c=s[1],or(a.pos,n._1.params,c.params),{TAG:0,_0:s[0],_1:c,_2:a}):n,_=Or(r,v,e);return Rr.contents=E(Rr.contents,_),v}function Br(M,r){var n,e,t,i=r[0],o=M.getContext("2d"),a=+M.width,u=+M.height,c=(e=v,{pos:{x:0,y:0},v_dim:{x:(n=[a,u])[0],y:n[1]},m_dim:{x:e[0],y:e[1]}}),s={bgd:(t=o,L(P(void 0,void 0,"bgd-1.png",1,0,[512,256],[0,0]),t)),ctx:o,vpt:kr(c,tr(i).pos),map:v[1],score:0,coins:0,multiplier:1,status:0};s.ctx.scale(1,1);var z=function(r,n,e,t,i){var o,a,u,c=n.status;if("number"==typeof c){if(0!==c)return(u=n.ctx).rect(0,0,512,512),u.fillStyle="black",u.fill(),u.fillStyle="white",u.font="20px 'Press Start 2P'",u.fillText("You win!",180,128)}else{var s=c._0;if(D<r-s){var v=R-((r-s|0)/1e3|0)|0;if(0<v)return o=n.ctx,a=v,o.rect(0,0,512,512),o.fillStyle="black",o.fill(),o.fillStyle="white",o.font="20px 'Press Start 2P'",o.fillText("GAME OVER. You lose! ",60,100),o.fillText(String(a),230,150),void requestAnimationFrame(function(r){return z(r,n,e,Rr.contents,jr.contents)});var _=zr(n.ctx);return Br(M,[_[0],_[1]])}}Rr.contents=0,jr.contents=0;var f,d,l,p,x,m=(f=Nr.contents,1/((r-f)/1e3));Nr.contents=r,l=(d=M).getContext("2d"),p=d.width,x=d.height,l.clearRect(0,0,p,x);var y,g,h=gr(n.vpt).x/5|0,b=0|n.bgd.params.frame_size[0];y=n.bgd,g=N(h,b),j(y,[-g,0]),j(y,[y.params.frame_size[0]-g,0]);var w=Yr(n,e,t);!0===tr(w).kill&&"number"==typeof n.status&&(n.status={_0:r});var k,A,T,E,G,C,I,S={bgd:n.bgd,ctx:n.ctx,vpt:kr(n.vpt,tr(w).pos),map:n.map,score:n.score,coins:n.coins,multiplier:n.multiplier,status:n.status};K(t,function(r){return Yr(S,r,t)}),K(i,function(r){return function(r,n){var e,t;(e=n).life=e.life-1|0,0===e.life&&(e.kill=!0),(t=e).vel.x=t.vel.x+t.acc.x,t.vel.y=t.vel.y+t.acc.y,e.pos.x=e.vel.x+e.pos.x,e.pos.y=e.vel.y+e.pos.y;var i=n.pos.x-gr(r.vpt).x,o=n.pos.y-gr(r.vpt).y;j(n.params.sprite,[i,o]),n.kill||(jr.contents={_0:n,_1:jr.contents})}(S,r)}),k=M,A=String(0|m),k.getContext("2d").fillText(A,10,18),T=M,E=S.coins,G=String(S.score),C=String(E),(I=T.getContext("2d")).font="10px 'Press Start 2P'",I.fillText("Score: "+G,T.width-140,18),I.fillText("Coins: "+C,120,18),requestAnimationFrame(function(r){return z(r,S,w,Rr.contents,jr.contents)})};return z(0,s,i,r[1],0)}function Vr(r){var n=r.keyCode;if(41<=n)switch(n){case 65:Dr.left=!0;break;case 66:Dr.bbox=(Dr.bbox+1|0)%2;break;case 68:Dr.right=!0;break;case 83:Dr.down=!0;break;case 67:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 84:case 85:case 86:break;case 87:Dr.up=!0}else if(32<=n)switch(n-32|0){case 1:case 2:case 3:case 4:break;case 5:Dr.left=!0;break;case 0:case 6:Dr.up=!0;break;case 7:Dr.right=!0;break;case 8:Dr.down=!0}return!0}function Hr(r){var n=r.keyCode;if(68<=n)83!==n?87!==n?69<=n||(Dr.right=!1):Dr.up=!1:Dr.down=!1;else if(41<=n)65!==n||(Dr.left=!1);else if(32<=n)switch(n-32|0){case 1:case 2:case 3:case 4:break;case 5:Dr.left=!1;break;case 0:case 6:Dr.up=!1;break;case 7:Dr.right=!1;break;case 8:Dr.down=!1}return!0}function Jr(){z();var r=document.getElementById(t),n=null!==r?r:(console.log("cant find canvas "+t+" \n"),T("fail")),e=n.getContext("2d");return document.addEventListener("keydown",Vr,!0),document.addEventListener("keyup",Hr,!0),z(),Br(n,zr(e))}function Kr(){var e={contents:0},t=r.length;return function(r,n){for(var e=0,t=r.length;e<t;++e)n(r[e])}(r,function(r){var n=document.createElement("img");n.src="sprites/"+r,n.addEventListener("load",function(r){return e.contents=e.contents+1|0,e.contents===t&&Jr(),!0},!0)}),0}window.onload=function(r){return Kr(),!0}}();
