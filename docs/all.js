!function(){"use strict";var r=["blocks.png","items.png","enemies.png","mario-small.png"],_=[2400,256],t="canvas",n=2400,i=256;function u(r,e,n){for(var t=new Array(n),i=0,o=e;i<n;)t[i]=r[o],i=i+1|0,o=o+1|0;return t}function f(r,e,n){if(e<0||e>=r.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};r[e]=n}function d(r,e){if(e<0||e>=r.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};return r[e]}function c(r,e){for(;;){var n=e,t=r,i=t.length,o=0===i?1:i,a=o-n.length|0;if(0==a)return t.apply(null,n);if(0<=a)return function(e,n){return function(r){return c(e,n.concat([r]))}}(t,n);e=u(n,o,0|-a),r=t.apply(null,u(n,0,o))}}function o(e){return 1===e.length?e:function(r){return function(a,u){var r=a.length;if(1===r)return a(u);switch(r){case 1:return a(u);case 2:return function(r){return a(u,r)};case 3:return function(r,e){return a(u,r,e)};case 4:return function(r,e,n){return a(u,r,e,n)};case 5:return function(r,e,n,t){return a(u,r,e,n,t)};case 6:return function(r,e,n,t,i){return a(u,r,e,n,t,i)};case 7:return function(r,e,n,t,i,o){return a(u,r,e,n,t,i,o)};default:return c(a,[u])}}(e,r)}}function a(n){return 2===n.length?n:function(r,e){return function(o,a,u){var r=o.length;if(2===r)return o(a,u);switch(r){case 1:return c(o(a),[u]);case 2:return o(a,u);case 3:return function(r){return o(a,u,r)};case 4:return function(r,e){return o(a,u,r,e)};case 5:return function(r,e,n){return o(a,u,r,e,n)};case 6:return function(r,e,n,t){return o(a,u,r,e,n,t)};case 7:return function(r,e,n,t,i){return o(a,u,r,e,n,t,i)};default:return c(o,[a,u])}}(n,r,e)}}function s(r,e){return r<e?r:e}function l(r,e){return e<r?r:e}var v=function(r,e){for(var n in r)e(n)};function p(e,n){if(e===n)return 1;var r=typeof e;if("string"!=r&&"number"!=r&&"boolean"!=r&&"undefined"!=r&&null!==e){var t=typeof n;if("function"==r||"function"==t)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: functional value",Error:new Error};if("number"!=t&&"undefined"!=t&&null!==n){var i=0|e.TAG,o=0|n.TAG;if(248==i)return e[1]===n[1];if(251==i)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: abstract value",Error:new Error};if(i==o){if(256==i)return e[1]===n[1];var a=0|e.length;if(a==(0|n.length)){if(!Array.isArray(e)){if(e instanceof Date&&n instanceof Date)return!(n<e||e<n);var u={contents:!0};return v(e,function(r){n.hasOwnProperty(r)||(u.contents=!1)}),u.contents&&v(n,function(r){e.hasOwnProperty(r)&&p(n[r],e[r])||(u.contents=!1)}),u.contents}for(var c=0;;){var s=c;if(s===a)return 1;if(!p(e[s],n[s]))return;c=s+1|0}}}}}}function x(r,e,n,t,i,o){var a=((e+r|0)+t|0)+o|0;return(a<<i|a>>>(32-i|0)|0)+n|0}function m(r,e,n,t,i,o,a){return x(e&n|(-1^e)&t,r,e,i,o,a)}function y(r,e,n,t,i,o,a){return x(e&t|n&(-1^t),r,e,i,o,a)}function g(r,e,n,t,i,o,a){return x(e^n^t,r,e,i,o,a)}function h(r,e,n,t,i,o,a){return x(n^(e|-1^t),r,e,i,o,a)}function b(r,e){var n=m(n=r[0],o=r[1],i=r[2],t=r[3],e[0],7,-680876936),t=m(t,n,o,i,e[1],12,-389564586),i=m(i,t,n,o,e[2],17,606105819),o=m(o,i,t,n,e[3],22,-1044525330);n=m(n,o,i,t,e[4],7,-176418897),t=m(t,n,o,i,e[5],12,1200080426),i=m(i,t,n,o,e[6],17,-1473231341),o=m(o,i,t,n,e[7],22,-45705983),n=m(n,o,i,t,e[8],7,1770035416),t=m(t,n,o,i,e[9],12,-1958414417),i=m(i,t,n,o,e[10],17,-42063),o=m(o,i,t,n,e[11],22,-1990404162),n=m(n,o,i,t,e[12],7,1804603682),t=m(t,n,o,i,e[13],12,-40341101),i=m(i,t,n,o,e[14],17,-1502002290),n=y(n,o=m(o,i,t,n,e[15],22,1236535329),i,t,e[1],5,-165796510),t=y(t,n,o,i,e[6],9,-1069501632),i=y(i,t,n,o,e[11],14,643717713),o=y(o,i,t,n,e[0],20,-373897302),n=y(n,o,i,t,e[5],5,-701558691),t=y(t,n,o,i,e[10],9,38016083),i=y(i,t,n,o,e[15],14,-660478335),o=y(o,i,t,n,e[4],20,-405537848),n=y(n,o,i,t,e[9],5,568446438),t=y(t,n,o,i,e[14],9,-1019803690),i=y(i,t,n,o,e[3],14,-187363961),o=y(o,i,t,n,e[8],20,1163531501),n=y(n,o,i,t,e[13],5,-1444681467),t=y(t,n,o,i,e[2],9,-51403784),i=y(i,t,n,o,e[7],14,1735328473),n=g(n,o=y(o,i,t,n,e[12],20,-1926607734),i,t,e[5],4,-378558),t=g(t,n,o,i,e[8],11,-2022574463),i=g(i,t,n,o,e[11],16,1839030562),o=g(o,i,t,n,e[14],23,-35309556),n=g(n,o,i,t,e[1],4,-1530992060),t=g(t,n,o,i,e[4],11,1272893353),i=g(i,t,n,o,e[7],16,-155497632),o=g(o,i,t,n,e[10],23,-1094730640),n=g(n,o,i,t,e[13],4,681279174),t=g(t,n,o,i,e[0],11,-358537222),i=g(i,t,n,o,e[3],16,-722521979),o=g(o,i,t,n,e[6],23,76029189),n=g(n,o,i,t,e[9],4,-640364487),t=g(t,n,o,i,e[12],11,-421815835),i=g(i,t,n,o,e[15],16,530742520),n=h(n,o=g(o,i,t,n,e[2],23,-995338651),i,t,e[0],6,-198630844),t=h(t,n,o,i,e[7],10,1126891415),i=h(i,t,n,o,e[14],15,-1416354905),o=h(o,i,t,n,e[5],21,-57434055),n=h(n,o,i,t,e[12],6,1700485571),t=h(t,n,o,i,e[3],10,-1894986606),i=h(i,t,n,o,e[10],15,-1051523),o=h(o,i,t,n,e[1],21,-2054922799),n=h(n,o,i,t,e[8],6,1873313359),t=h(t,n,o,i,e[15],10,-30611744),i=h(i,t,n,o,e[6],15,-1560198380),o=h(o,i,t,n,e[13],21,1309151649),n=h(n,o,i,t,e[4],6,-145523070),t=h(t,n,o,i,e[11],10,-1120210379),i=h(i,t,n,o,e[2],15,718787259),o=h(o,i,t,n,e[9],21,-343485551),r[0]=n+r[0]|0,r[1]=o+r[1]|0,r[2]=i+r[2]|0,r[3]=t+r[3]|0}var w=[1732584193,-271733879,-1732584194,271733878],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function A(r,e){if(e>=r.length||e<0)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};return r.charCodeAt(e)}function T(r){throw{RE_EXN_ID:"Failure",_1:r,Error:new Error}}function E(r,e){return r?{_0:r._0,_1:E(r._1,e)}:e}function G(r){return function(r,e,n){var t=r.slice(e,n),i=t.length;w[0]=1732584193,w[1]=-271733879,w[2]=-1732584194,w[3]=271733878;for(var o=0;o<=15;++o)k[o]=0;for(var a=i/64|0,u=1;u<=a;++u){for(var c=0;c<=15;++c){var s=((u<<6)-64|0)+(c<<2)|0;k[c]=((t.charCodeAt(s)+(t.charCodeAt(1+s|0)<<8)|0)+(t.charCodeAt(2+s|0)<<16)|0)+(t.charCodeAt(3+s|0)<<24)|0}b(w,k)}for(var _=t.slice(a<<6),v=0;v<=15;++v)k[v]=0;for(var f=_.length-1|0,d=0;d<=f;++d)k[d/4|0]=k[d/4|0]|_.charCodeAt(d)<<(d%4<<3);var l=1+f|0;if(k[l/4|0]=k[l/4|0]|128<<(l%4<<3),55<l){b(w,k);for(var p=0;p<=15;++p)k[p]=0}return k[14]=i<<3,b(w,k),String.fromCharCode(255&w[0],w[0]>>8&255,w[0]>>16&255,w[0]>>24&255,255&w[1],w[1]>>8&255,w[1]>>16&255,w[1]>>24&255,255&w[2],w[2]>>8&255,w[2]>>16&255,w[2]>>24&255,255&w[3],w[3]>>8&255,w[3]>>16&255,w[3]>>24&255)}(r,0,r.length)}function e(r,e){if(1073741823<e||e<=0)throw{RE_EXN_ID:"Invalid_argument",_1:"Random.int",Error:new Error};for(;;){var n=function(r){r.idx=(r.idx+1|0)%55;var e=d(r.st,r.idx),n=1073741823&(d(r.st,(r.idx+24|0)%55)+(e^e>>>25&31)|0);return f(r.st,r.idx,n),n}(r),t=n%e;if((n-t|0)<=(1+(1073741823-e|0)|0))return t}}var S={st:[987910699,495797812,364182224,414272206,318284740,990407751,383018966,270373319,840823159,24560019,536292337,512266505,189156120,730249596,143776328,51606627,140166561,366354223,1003410265,700563762,981890670,913149062,526082594,1021425055,784300257,667753350,630144451,949649812,48546892,415514493,258888527,511570777,89983870,283659902,308386020,242688715,482270760,865188196,1027664170,207196989,193777847,619708188,671350186,149669678,257044018,87658204,558145612,183450813,28133145,901332182,710253903,510646120,652377910,409934019,801085050],idx:0};function C(r){return e(S,r)}function I(r){return function(r,e){for(var n=0===e.length?[0]:e,t=n.length,i=0;i<=54;++i)f(r.st,i,i);for(var o,a,u,c="x",s=0,_=54+(t<55?55:t)|0;s<=_;++s){var v=s%55;a=c,u=d(n,s%t),c=G(a+String(u)),f(r.st,v,1073741823&(d(r.st,v)^(((A(o=c,0)+(A(o,1)<<8)|0)+(A(o,2)<<16)|0)+(A(o,3)<<24)|0)))}r.idx=0}(S,r)}function M(){return I([(4294967295^(0|Date.now()))*Math.random()|0])}function j(r,e){var n=r.context,t=r.params.src_offset,i=r.params.frame_size,o=i[0],a=r.params.frame_size,u=t[0]+r.frame.contents*o;return n.drawImage(r.img,u,t[1],o,i[1],e[0],e[1],a[0],a[1])}function N(r,e){if(0===e)throw{RE_EXN_ID:"Division_by_zero",Error:new Error};return r%e}function z(r,e,n,t,i,o,a){var u=void 0!==e?e:[0,0];return{max_frames:t,max_ticks:i,img_src:"./sprites/"+n,frame_size:o,src_offset:a,bbox_offset:void 0!==r?r:[0,0],bbox_size:p(u,[0,0])?o:u}}function D(r){var e=r[1];switch(r[0]){case 0:return z([1,1],[14,14],"enemies.png",2,10,[16,16],[0,128]);case 1:return e?z([1,10],[11,16],"enemies.png",2,10,[16,27],[32,69]):z([4,10],[11,16],"enemies.png",2,10,[16,27],[0,69]);case 2:return e?z([1,10],[11,16],"enemies.png",2,10,[16,27],[32,5]):z([4,10],[11,16],"enemies.png",2,10,[16,27],[0,5]);case 3:return z([2,2],[12,13],"enemies.png",4,10,[16,16],[0,96]);case 4:return z([2,2],[12,13],"enemies.png",4,10,[16,16],[0,32])}}function P(r,e){var n=document.createElement("img");return n.src=r.img_src,{params:r,context:e,frame:{contents:0},ticks:{contents:0},img:n}}function R(r,e,n){return P(function(r,e){switch(0|r.TAG){case 0:var n=r._0,t=[r._1,e];if(n){var i=t[0];if(t[1])switch(i){case 0:return z([1,1],[11,15],"mario-small.png",1,0,[16,16],[0,32]);case 1:return z([2,1],[13,15],"mario-small.png",2,10,[16,16],[16,48]);case 2:return z([2,1],[12,15],"mario-small.png",3,5,[16,16],[16,32]);case 3:return z([1,5],[14,10],"mario-small.png",1,0,[16,16],[0,64])}else switch(i){case 0:return z([3,1],[11,15],"mario-small.png",1,0,[16,16],[0,0]);case 1:return z([2,1],[13,15],"mario-small.png",2,10,[16,16],[16,16]);case 2:return z([2,1],[12,15],"mario-small.png",3,5,[16,16],[16,0]);case 3:return z([1,5],[14,10],"mario-small.png",1,0,[16,16],[0,64])}}else{var o=t[0];if(t[1])switch(o){case 0:return z([1,1],[13,25],"mario-big.png",1,0,[16,26],[16,69]);case 1:return z([2,1],[12,25],"mario-big.png",1,0,[16,26],[48,70]);case 2:return z([2,1],[13,25],"mario-big.png",4,10,[16,27],[0,101]);case 3:return z([2,10],[13,17],"mario-big.png",1,0,[16,27],[32,69])}else switch(o){case 0:return z([2,1],[13,25],"mario-big.png",1,0,[16,27],[16,5]);case 1:return z([2,1],[12,25],"mario-big.png",1,0,[16,26],[48,6]);case 2:return z([2,1],[13,25],"mario-big.png",4,10,[16,27],[0,37]);case 3:return z([2,10],[13,17],"mario-big.png",1,0,[16,27],[32,5])}}case 1:return D([r._0,e]);case 2:return r._0?z([3,0],[12,16],"items.png",3,15,[16,16],[0,80]):z([2,0],[12,16],"items.png",1,0,[16,16],[0,0]);case 3:var a=r._0;if("number"!=typeof a)return z(void 0,void 0,"blocks.png",4,15,[16,16],[0,16]);switch(a){case 0:return z(void 0,void 0,"blocks.png",1,0,[16,16],[0,32]);case 1:return z(void 0,void 0,"blocks.png",5,10,[16,16],[0,0]);case 2:return z(void 0,void 0,"blocks.png",1,0,[16,16],[0,48]);case 3:return z(void 0,void 0,"blocks.png",1,0,[16,16],[0,64]);case 4:return z(void 0,void 0,"panel.png",3,15,[26,26],[0,0]);case 5:return z(void 0,void 0,"ground.png",1,0,[16,16],[0,32])}}}(r,e),n)}function X(r,e){return P(function(r){switch(r){case 0:return z(void 0,void 0,"enemies.png",1,0,[16,16],[0,144]);case 1:return z(void 0,void 0,"chunks.png",1,0,[8,8],[0,0]);case 2:return z(void 0,void 0,"chunks.png",1,0,[8,8],[8,0]);case 3:return z(void 0,void 0,"score.png",1,0,[12,8],[0,0]);case 4:return z(void 0,void 0,"score.png",1,0,[12,9],[0,9]);case 5:return z(void 0,void 0,"score.png",1,0,[12,9],[0,18]);case 6:return z(void 0,void 0,"score.png",1,0,[12,9],[0,27]);case 7:return z(void 0,void 0,"score.png",1,0,[14,9],[13,0]);case 8:return z(void 0,void 0,"score.png",1,0,[14,9],[13,9]);case 9:return z(void 0,void 0,"score.png",1,0,[14,9],[13,18]);case 10:return z(void 0,void 0,"score.png",1,0,[14,9],[13,27])}}(r),e)}function F(r){return{x:r[0],y:r[1]}}function q(r,e,n,t,i){var o,a,u=void 0!==r?r:[0,0],c=void 0!==e?e:[0,0],s=(a=i,2===(o=n)||1===o?{sprite:X(o,a),lifetime:300}:{sprite:X(o,a),lifetime:30});return{params:s,pos:F(t),vel:F(u),acc:F(c),kill:!1,life:s.lifetime}}function L(r,e,n){return q([.5,-.7],void 0,801<=r?2001<=r?4e3!==r?8e3!==r?3:10:9:1e3!==r?2e3<=r?8:3:7:201<=r?400!==r?800<=r?6:3:5:100!==r&&200<=r?4:3,e,n)}var O=function(r,e){r._1=e};function Y(r,e){return function(r,e){for(;;){var n=r;if(!n)return;e(n._0),r=n._1}}(r,o(e)),0}function B(r,e,n){return function(r,e,n){for(;;){var t=r;if(!t)return e;e=n(e,t._0),r=t._1}}(r,e,a(n))}function V(r,e){for(;;){if(!r)return 0;var n=r._1,t=r._0;if(e(t)){var i={_0:t,_1:0};return function(r,e,n){for(;;){var t=n;if(!e)return;var i,o=e._1,a=e._0;r(a)?(O(t,i={_0:a,_1:0}),n=i,e=o):e=o}}(e,n,i),i}r=n}}var H={contents:-2147483648};function J(r,e){return{has_gravity:void 0===r||r,speed:void 0!==e?e:1}}function K(r){var e=r.params.speed,n=r.dir;r.vel.x=n?e:-e}function Q(r,e,n,t){var i=void 0!==r?r:0;return[R(e,i,n),{params:function(r){switch(0|r.TAG){case 0:return J(void 0,2.8);case 1:return J(void 0,3<=r._0?3:void 0);case 2:return J(!r._0&&void 0,void 0);case 3:return r._0,J(!1,void 0)}}(e),pos:t,vel:{x:0,y:0},id:(H.contents=H.contents+1|0,H.contents),jumping:!1,grounded:!1,dir:i,invuln:0,kill:!1,health:1,crouch:!1,score:0}]}function U(r,e,n){var t=Q(void 0,r,e,n),i=t[1],o=t[0];switch(0|r.TAG){case 0:return{TAG:0,_0:r._0,_1:o,_2:i};case 1:return K(i),{TAG:1,_0:r._0,_1:o,_2:i};case 2:return{TAG:2,_0:r._0,_1:o,_2:i};case 3:return{TAG:3,_0:r._0,_1:o,_2:i}}}function W(r){return r._2}function Z(r){return!r.TAG}function $(r,e,n){var t=e.bbox_offset,i=n.bbox_offset,o=e.bbox_size,a=n.bbox_size;r.x=r.x-(a[0]+i[0])+(o[0]+t[0]),r.y=r.y-(a[1]+i[1])+(o[1]+t[1])}function rr(r,e){var n,t;(n=r).grounded?n.vel.y=0:n.params.has_gravity&&(n.vel.y=s(n.vel.y+.2+.01*Math.abs(n.vel.y),4.5)),(t=r).pos.x=t.vel.x+t.pos.x,t.params.has_gravity&&(t.pos.y=t.vel.y+t.pos.y),r.pos.y>e&&(r.kill=!0)}function er(r,e){1!==r?0!==r?e.vel.x=0:e.vel.y=-.001:(e.vel.y=0,e.grounded=!0,e.jumping=!1)}function nr(r){r.vel.x=-r.vel.x,r.dir=r.dir?0:1}function tr(r,e,n,t,i){switch(e){case 0:return void(t.kill=!0);case 1:var o=Q(t.dir,{TAG:1,_0:3},i,t.pos),a=o[1],u=o[0];return $(a.pos,n.params,u.params),{TAG:1,_0:3,_1:u,_2:a};case 2:var c=Q(t.dir,{TAG:1,_0:4},i,t.pos),s=c[1],_=c[0];return $(s.pos,n.params,_.params),{TAG:1,_0:4,_1:_,_2:s}}t.dir=r,0!==t.vel.x?t.vel.x=0:K(t)}function ir(r,e,n){nr(r);var t,i,o,a,u,c=n.params;return t=e,i=n,o=r.dir,a=D([t,o]),(u=document.createElement("img")).src=a.img_src,i.params=a,i.img=u,$(r.pos,c,n.params),0}function or(r){var e=r.health-1|0;return 0==e?void(r.kill=!0):0===r.invuln&&void(r.health=e)}function ar(r,e){or(r);var n=Q(void 0,{TAG:3,_0:0},e,r.pos);return{TAG:3,_0:0,_1:n[0],_2:n[1]}}function ur(r,e,n,t){var i=U({TAG:2,_0:n},t,e.pos),o=i._2;return o.pos.y=o.pos.y-i._1.params.frame_size[1],o.dir=r?0:1,K(o),i}function cr(r){var e=r._1.params,n=r._2,t=e.bbox_offset,i=n.pos.x+t[0],o=n.pos.y+t[1],a=e.bbox_size,u=a[1],c=a[0];return{center:{x:i+c/2,y:o+u/2},half:{x:c/2,y:u/2}}}function sr(r,e){var n=cr(r),t=cr(e),i=r._2;if(!function(r,e){var n,t=r._2,i=e._2;switch(0|r.TAG){case 0:n=1===e.TAG&&0<r._2.invuln;break;case 1:n=2===e.TAG;break;case 2:switch(0|e.TAG){case 1:case 2:n=!0;break;case 0:case 3:n=!1}break;case 3:n=!1}return t.kill||i.kill||n}(r,e)){var o=n.center.x-t.center.x,a=n.center.y-t.center.y,u=n.half.x+t.half.x,c=n.half.y+t.half.y;if(Math.abs(o)<u&&Math.abs(a)<c){var s=u-Math.abs(o),_=c-Math.abs(a);return _<=s?0<a?(i.pos.y=i.pos.y+_,0):(i.pos.y=i.pos.y-_,1):0<o?(i.pos.x=i.pos.x+s,3):(i.pos.x=i.pos.x-s,2)}}}var _r=60,vr=4;function fr(r){return r.pos}function dr(r,e,n){var t=e/2;return s(l(r-t,0),s(n-e,Math.abs(r-t)))}function lr(r,e){var n=r.pos.x-32,t=r.pos.x+r.v_dim.x,i=r.pos.y-32,o=r.pos.y+r.v_dim.y,a=e.x,u=e.y;return n<=a&&a<=t&&i<=u&&u<=o}function pr(r,e){return r.pos.y+r.v_dim.y<=e}function xr(r,e){return{pos:{x:dr(e.x,r.v_dim.x,r.m_dim.x),y:dr(e.y,r.v_dim.y,r.m_dim.y)},v_dim:r.v_dim,m_dim:r.m_dim}}function mr(r,e){for(;;){var n=e;if(!n)return;if(p(r,n._0[1]))return 1;e=n._1}}function yr(r,e){for(;;){if(!r)return 0;var n=r._1,t=r._0;if(!mr(t[1],e))return E({_0:t,_1:0},yr(n,e));r=n}}function gr(r,e,n){for(;;){if(!r)return 0;var t=r._1,i=r._0,o=i[1].x,a=i[1].y;if(!(o<128||16*e-o<528||0===a||16*n-a<48))return E({_0:i,_1:0},gr(t,e,n));r=t}}function hr(r,e,n,t,i){if(r<n||e<t)return 0;var o,a,u,c,s,_,v,f,d,l=C(4),p=C(2),x=0===C(5)?3:p;switch(i){case 0:return 2<r-n?{_0:[p,{x:n,y:t}],_1:{_0:[x,{x:n+1,y:t}],_1:{_0:[p,{x:n+2,y:t}],_1:0}}}:1<r-n?{_0:[l,{x:n,y:t}],_1:{_0:[l,{x:n+1,y:t}],_1:0}}:{_0:[l,{x:n,y:t}],_1:0};case 1:var m=C(5)+5|0;return t<5?function r(e,n,t,i){return 0===i?0:E({_0:[t,{x:e,y:n}],_1:0},r(e+1,n,t,i-1|0))}(n,t,2,m):0;case 2:return e-t==1?E({_0:[d=p,{x:v=n,y:f=t}],_1:{_0:[d,{x:v+1,y:f}],_1:{_0:[d,{x:v+2,y:f}],_1:{_0:[d,{x:v+3,y:f}],_1:0}}}},E({_0:[d,{x:v+1,y:f-1}],_1:{_0:[d,{x:v+2,y:f-1}],_1:{_0:[d,{x:v+3,y:f-1}],_1:0}}},E({_0:[d,{x:v+2,y:f-2}],_1:{_0:[d,{x:v+3,y:f-2}],_1:0}},{_0:[d,{x:v+3,y:f-3}],_1:0}))):0;case 3:return 0===p&&3<e-t?E({_0:[_=p,{x:c=n,y:s=t}],_1:{_0:[_,{x:c+1,y:s}],_1:{_0:[_,{x:c+2,y:s}],_1:0}}},E({_0:[_,{x:c+2,y:s+1}],_1:{_0:[_,{x:c+3,y:s+1}],_1:0}},{_0:[_,{x:c+5,y:s+2}],_1:{_0:[_,{x:c+6,y:s+2}],_1:0}})):2<e-t?E({_0:[u=p,{x:o=n,y:a=t}],_1:{_0:[u,{x:o+1,y:a}],_1:0}},E({_0:[u,{x:o+3,y:a-1}],_1:{_0:[u,{x:o+4,y:a-1}],_1:0}},{_0:[u,{x:o+4,y:a-2}],_1:{_0:[u,{x:o+5,y:a-2}],_1:{_0:[u,{x:o+6,y:a-2}],_1:0}}})):{_0:[p,{x:n,y:t}],_1:0};case 4:return t+3-e==2?{_0:[p,{x:n,y:t}],_1:0}:t+3-e==1?{_0:[p,{x:n,y:t}],_1:{_0:[p,{x:n,y:t+1}],_1:0}}:{_0:[p,{x:n,y:t}],_1:{_0:[p,{x:n,y:t+1}],_1:{_0:[p,{x:n,y:t+2}],_1:0}}};case 5:return{_0:[3,{x:n,y:t}],_1:0};default:return T("Shouldn't reach here")}}function br(r,e){if(!r)return 0;var n=r._0;return E({_0:U({TAG:3,_0:function(r){switch(r){case 0:return 1;case 1:return 2;case 2:return 3;case 3:return{_0:0};case 4:return 5;default:return T("Shouldn't reach here")}}(n[0])},e,n[1]),_1:0},br(r._1,e))}function wr(r,e){if(!r)return 0;var n=r._0;return E({_0:U({TAG:1,_0:function(r){switch(r){case 0:return 2;case 1:return 1;case 2:return 0;default:return T("Shouldn't reach here")}}(n[0])},e,n[1]),_1:0},wr(r._1,e))}function kr(r,e,n,t,i){var o=function(r,e,n,t,i){for(;;){var o,a=i,u=t,c=n;if(r-c<33)return a;e-1<u?(t=0,n=c+1):t=(mr({x:c,y:u},a)||0===u||(o=C(100))<5&&(i=E(a,yr(hr(r,e,c,u,o),a))),u+1)}}(r,e,0,0,0),a=gr(function r(e){if(!e)return 0;var n=e._0;return E({_0:[n[0],{x:16*n[1].x,y:16*n[1].y}],_1:0},r(e._1))}(o),r,e),u=br(a,i),c=function(r,e,n,t){for(;;){var i=t,o=n;if(r<o)return i;if(10<o){var a=C(10),u=E(i,{_0:[4,{x:16*o,y:16*e}],_1:0});if(7===a&&32<r-o){n=o+1;continue}t=u,n=o+1}else{t=E(i,{_0:[4,{x:16*o,y:16*e}],_1:0}),n=o+1}}}(r,e,0,0),s=br(c,i),_=E(o,c),v=E(u,s),f=wr(function r(e,n,t,i,o){for(;;){var a=i,u=t;if(e-32<u)return 0;if(n-1<a||u<15)i=0,t=u+1;else if(mr({x:u,y:a},o)||0===a)i=a+1;else{var c=C(30);if(c<3&&n-1===a)return E({_0:[c,{x:16*u,y:16*a}],_1:0},r(e,n,u,a+1,o));i=a+1}}}(r,e,0,0,_),i),d=function r(e){for(;;){var n=e,t=C(2);if(!n)return 0;var i=n._1,o=n._0;if(0===t)return E({_0:[0,{x:o[1].x,y:o[1].y-16}],_1:0},r(i));e=i}}(a),l=gr(yr(d,a),r,e),p=E(a,d),x=wr(yr(function r(e){for(;;){var n=e,t=C(20),i=C(3);if(!n)return 0;var o=n._1,a=n._0;if(0===t)return E({_0:[i,{x:a[1].x,y:a[1].y-16}],_1:0},r(o));e=o}}(a),p),i),m=function r(e,n){return e?E({_0:U({TAG:2,_0:1},n,e._0[1]),_1:0},r(e._1,n)):0}(l,i);return E(v,E(f,E(m,E(x,{_0:U({TAG:3,_0:4},i,{x:16*r-256,y:16*e*2/3}),_1:0}))))}function Ar(r){var e=kr(n/16,i/16-1,0,0,r);return[U({TAG:0,_0:1,_1:0},r,{x:100,y:224}),e]}var Tr={left:!1,right:!1,up:!1,down:!1,bbox:0},Er={contents:0},Gr={contents:0},Sr={contents:0};function Cr(r,e){r.score=r.score+e|0}function Ir(r,e,n,t,i){return 3<=e?[void 0,0===t.vel.x?tr(r.dir,e,n,t,i):(or(r),void(r.invuln=_r))]:(or(r),r.invuln=_r,[void 0,void 0])}function Mr(r,e,n,t){var i,o,a,u,c,s,_,v=t.ctx,f=0;switch(0|e.TAG){case 0:var d=e._2;switch(0|n.TAG){case 0:return[void 0,void 0];case 1:var l=n._2,p=n._1,x=n._0;if(1!==r)return Ir(d,x,p,l,v);i=d,o=x,a=p,u=l,f=1;break;case 2:c=d,s=n._0,_=n._2,f=2;break;case 3:var m=n._2,y=n._0;if(0!==r){return"number"==typeof y&&4===y?(t.status=1,[void 0,void 0]):(1!==r||(t.multiplier=1),er(r,d),[void 0,void 0])}if("number"==typeof y)return 1!==y?4!==y?er(r,d):t.status=1:0===e._0?(er(r,d),or(m)):er(r,d),[void 0,void 0];var g=ar(m,v),h=ur(d.dir,m,y._0,v);return er(r,d),[h,g]}break;case 1:var b=e._2,w=e._1,k=e._0;switch(0|n.TAG){case 0:var A=n._2;if(0!==r)return Ir(A,k,w,b,v);i=A,o=k,a=w,u=b,f=1;break;case 1:return function(r,e,n,t,i,o,a){if(3!==r){if(r<4)return 3<=t?0===o.vel.x?ir(n,r,e):or(n):2<=a&&(ir(n,r,e),ir(o,t,i)),[void 0,void 0];if(3<=t)return or(n),or(o),[void 0,void 0]}else if(3<=t)return or(n),or(o),[void 0,void 0];return 0===n.vel.x?ir(o,t,i):or(o),[void 0,void 0]}(k,w,b,n._0,n._1,n._2,r);case 2:return[void 0,void 0];case 3:var T=n._2,E=n._0;if(2<=r){if(3<=k){if("number"==typeof E)return 1!==E?ir(b,k,w):(or(T),nr(b)),[void 0,void 0];var G=ar(T,v),S=ur(b.dir,T,E._0,v);return ir(b,k,w),[G,S]}return ir(b,k,w),[void 0,void 0]}return er(r,b),[void 0,void 0]}break;case 2:var C=e._2;switch(0|n.TAG){case 0:c=n._2,s=e._0,_=C,f=2;break;case 1:case 2:return[void 0,void 0];case 3:return 2<=r?nr(C):er(r,C),[void 0,void 0]}break;case 3:return[void 0,void 0]}switch(f){case 1:return function(r,e,n,t,i,o){if(r.invuln=10,r.jumping=!1,r.grounded=!0,3<=e){var a=tr(r.dir,e,n,t,o);return r.vel.y=-vr,r.pos.y=r.pos.y-5,[void 0,a]}if(or(t),r.vel.y=-vr,8===i.multiplier)return Cr(i,800),t.score=800,[void 0,tr(r.dir,e,n,t,o)];var u=Math.imul(100,i.multiplier);return Cr(i,u),t.score=u,i.multiplier=i.multiplier<<1,[void 0,tr(r.dir,e,n,t,o)]}(i,o,a,u,t,v);case 2:return s?(t.coins=t.coins+1|0,or(_),Cr(t,100)):(or(_),2===c.health||(c.health=c.health+1|0),c.vel.x=0,c.vel.y=0,Cr(t,1e3),_.score=1e3),[void 0,void 0]}}function zr(e,r,n){var t=W(e);return V(r,o(function(r){return!(!lr(n.vpt,t.pos)&&!Z(e))||pr(n.vpt,t.pos.y)}))}function Dr(r,e,n){return 3===r.TAG?0:function(r,e,n){for(var t,i=e,o=0;;){var a=o,u=i;if(!u)return a;var c,s,_=u._0,v=W(r);t=_;var f,d,l=(s=r._2.id!==t._2.id&&void 0!==(c=sr(r,_))&&W(_).id!==v.id?Mr(c,r,_,n):[void 0,void 0])[0],o=void 0!==l?void 0!==(f=s[1])?{_0:l,_1:{_0:f,_1:a}}:{_0:l,_1:a}:void 0!==(d=s[1])?{_0:d,_1:a}:a,i=u._1}}(r,zr(r,e,n),n)}function Rr(r,e,n){var t=W(e),i=e._1;t.invuln=0<t.invuln?t.invuln-1|0:0;var o=lr(r.vpt,t.pos)||Z(e)||pr(r.vpt,t.pos.y);if(t.kill||!o)return 0;t.grounded=!1,rr(t,r.map);var a,u,c,s,_,v,f,d,l,p=Dr(e,n,r),x=(a=r.vpt,{x:(u=t.pos).x-a.pos.x,y:u.y-a.pos.y});return j(i,[x.x,x.y]),1===Tr.bbox&&(s=[x.x,x.y],_=(c=i).context,v=c.params.bbox_offset,f=c.params.bbox_size,_.strokeStyle="#FF0000",_.strokeRect(s[0]+v[0],s[1]+v[1],f[0],f[1])),0===t.vel.x&&1===e.TAG||((l=(d=i).ticks.contents)>=d.params.max_ticks?(d.ticks.contents=0,d.frame.contents=N(d.frame.contents+1|0,d.params.max_frames)):d.ticks.contents=l+1|0),p}function jr(r,e,n){if(e.TAG){var t=W(e),i=Rr(r,e,n);t.kill||(Er.contents={_0:e,_1:E(Er.contents,i)});var o=t.kill?function(r,e){switch(0|r.TAG){case 0:return 0;case 1:var n=r._2,t=[n.pos.x,n.pos.y];return E(0<n.score?{_0:L(n.score,t,e),_1:0}:0,0!==r._0?0:{_0:q(void 0,void 0,0,t,e),_1:0});case 2:var i=r._2;return r._0?0:{_0:L(i.score,[i.pos.x,i.pos.y],e),_1:0};case 3:var o=r._2,a=r._0;if("number"!=typeof a)return 0;if(1!==a)return 0;var u=[o.pos.x,o.pos.y];return{_0:q([-5,-5],[0,.2],1,u,e),_1:{_0:q([-3,-4],[0,.2],1,u,e),_1:{_0:q([3,-4],[0,.2],2,u,e),_1:{_0:q([5,-5],[0,.2],2,u,e),_1:0}}}}}}(e,r.ctx):0;return Gr.contents=E(Gr.contents,o),e}var a=e._2,u=B({_0:[Tr.left,0],_1:{_0:[Tr.right,1],_1:{_0:[Tr.up,2],_1:{_0:[Tr.down,3],_1:0}}}},0,function(r,e){return e[0]?{_0:e[1],_1:r}:r});a.crouch=!1;var c,s=function(n,r,e){var t=n.jumping,i=n.dir,o=Math.abs(n.vel.x);Y(r,function(r){var e=.2*n.vel.x;switch(r){case 0:return n.crouch?void 0:(n.vel.x>-n.params.speed&&(n.vel.x=n.vel.x-(.4-e)),void(n.dir=0));case 1:return n.crouch?void 0:(n.vel.x<n.params.speed&&(n.vel.x=n.vel.x+(.4+e)),void(n.dir=1));case 2:return!n.jumping&&n.grounded?(n.jumping=!0,n.grounded=!1,void(n.vel.y=l(n.vel.y-(5.7+.25*Math.abs(n.vel.x)),-6))):void 0;case 3:return!n.jumping&&n.grounded?void(n.crouch=!0):void 0}});var a=.9*n.vel.x,u=Math.abs(a)<.1?0:a;n.vel.x=u;var c=n.health<=1?1:0;return!t&&n.jumping?[c,R({TAG:0,_0:c,_1:1},n.dir,e)]:i!==n.dir||0===o&&0<Math.abs(n.vel.x)&&!n.jumping?[c,R({TAG:0,_0:c,_1:2},n.dir,e)]:i!==n.dir&&n.jumping&&t?[c,R({TAG:0,_0:c,_1:1},n.dir,e)]:0===n.vel.y&&n.crouch?[c,R({TAG:0,_0:c,_1:3},n.dir,e)]:0===n.vel.y&&0===n.vel.x?[c,R({TAG:0,_0:c,_1:0},n.dir,e)]:void 0}(a,u,r.ctx),_=void 0!==s?(c=s[1],$(a.pos,e._1.params,c.params),{TAG:0,_0:s[0],_1:c,_2:a}):e,v=Rr(r,_,n);return Er.contents=E(Er.contents,v),_}function Nr(D,r){var e,n,t,i=r[0],o=D.getContext("2d"),a=+D.width,u=+D.height,c=(n=_,{pos:{x:0,y:0},v_dim:{x:(e=[a,u])[0],y:e[1]},m_dim:{x:n[0],y:n[1]}}),s={bgd:(t=o,P(z(void 0,void 0,"bgd-1.png",1,0,[512,256],[0,0]),t)),ctx:o,vpt:xr(c,W(i).pos),map:_[1],score:0,coins:0,multiplier:1,status:0};s.ctx.scale(1,1);var R=function(r,n,e,t,i){for(;;){var o=i,a=t,u=e,c=n.status;if("number"==typeof c){if(0!==c)return(z=n.ctx).rect(0,0,512,512),z.fillStyle="black",z.fill(),z.fillStyle="white",z.font="20px 'Press Start 2P'",z.fillText("You win!",180,128);Er.contents=0,Gr.contents=0;var s=(M=Sr.contents,1/((r-M)/1e3));Sr.contents=r,S=void 0,S=(G=D).getContext("2d"),C=G.width,I=G.height,S.clearRect(0,0,C,I);var _=fr(n.vpt).x/5|0,v=0|n.bgd.params.frame_size[0];T=n.bgd,E=N(_,v),j(T,[-E,0]),j(T,[T.params.frame_size[0]-E,0]);var f=jr(n,u,a);if(!0===W(f).kill){n.status={_0:r},i=Gr.contents,t=Er.contents,e=f;continue}var d={bgd:n.bgd,ctx:n.ctx,vpt:xr(n.vpt,W(f).pos),map:n.map,score:n.score,coins:n.coins,multiplier:n.multiplier,status:n.status};return Y(a,function(e,n){return function(r){return jr(n,r,e)}}(a,d)),Y(o,function(e){return function(r){return function(r,e){var n,t;(n=e).life=n.life-1|0,0===n.life&&(n.kill=!0),(t=n).vel.x=t.vel.x+t.acc.x,t.vel.y=t.vel.y+t.acc.y,n.pos.x=n.vel.x+n.pos.x,n.pos.y=n.vel.y+n.pos.y;var i=e.pos.x-fr(r.vpt).x,o=e.pos.y-fr(r.vpt).y;j(e.params.sprite,[i,o]),e.kill||(Gr.contents={_0:e,_1:Gr.contents})}(e,r)}}(d)),k=D,A=String(0|s),k.getContext("2d").fillText(A,10,18),y=D,g=d.coins,w=void 0,h=String(d.score),b=String(g),(w=y.getContext("2d")).font="10px 'Press Start 2P'",w.fillText("Score: "+h,y.width-140,18),w.fillText("Coins: "+b,120,18),void requestAnimationFrame(function(e,n){return function(r){return R(r,n,e,Er.contents,Gr.contents)}}(f,d))}var l=5-((r-c._0|0)/1e3|0)|0;if(0<l)return x=n.ctx,m=l,x.rect(0,0,512,512),x.fillStyle="black",x.fill(),x.fillStyle="white",x.font="20px 'Press Start 2P'",x.fillText("GAME OVER. You lose! ",60,128),x.fillText(String(m),230,200),void requestAnimationFrame(function(e){return function(r){return R(r,n,e,Er.contents,Gr.contents)}}(u));var p=Ar(n.ctx);return Nr(D,[p[0],p[1]])}var x,m,y,g,h,b,w,k,A,T,E,G,S,C,I,M,z};return R(0,s,i,r[1],0)}function Pr(r){var e=r.keyCode;if(41<=e)switch(e){case 65:Tr.left=!0;break;case 66:Tr.bbox=(Tr.bbox+1|0)%2;break;case 68:Tr.right=!0;break;case 83:Tr.down=!0;break;case 67:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 84:case 85:case 86:break;case 87:Tr.up=!0}else if(32<=e)switch(e-32|0){case 1:case 2:case 3:case 4:break;case 5:Tr.left=!0;break;case 0:case 6:Tr.up=!0;break;case 7:Tr.right=!0;break;case 8:Tr.down=!0}return!0}function Xr(r){var e=r.keyCode;if(68<=e)83!==e?87!==e?69<=e||(Tr.right=!1):Tr.up=!1:Tr.down=!1;else if(41<=e)65!==e||(Tr.left=!1);else if(32<=e)switch(e-32|0){case 1:case 2:case 3:case 4:break;case 5:Tr.left=!1;break;case 0:case 6:Tr.up=!1;break;case 7:Tr.right=!1;break;case 8:Tr.down=!1}return!0}function Fr(){M();var r=document.getElementById(t),e=null!==r?r:(console.log("cant find canvas "+t+" \n"),T("fail")),n=e.getContext("2d");return document.addEventListener("keydown",Pr,!0),document.addEventListener("keyup",Xr,!0),M(),Nr(e,Ar(n))}function qr(){var n={contents:0},t=r.length;return function(r,e){for(var n=0,t=r.length;n<t;++n)e(r[n])}(r,function(r){var e=document.createElement("img");e.src="sprites/"+r,e.addEventListener("load",function(r){return n.contents=n.contents+1|0,n.contents===t&&Fr(),!0},!0)}),0}window.onload=function(r){return qr(),!0}}();
